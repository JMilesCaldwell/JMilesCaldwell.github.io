<script>
  const disclaimer = document.getElementById('disclaimer');
  const enterBtn   = document.getElementById('enter-btn');
  const returnBtn  = document.getElementById('return-btn');
  const audio      = document.getElementById('ambience');
  const glitch     = document.getElementById('glitch');

  // Dismiss popup and start audio + glitch loop
  enterBtn.addEventListener('click', () => {
    disclaimer.style.display = 'none';
    audio.muted  = false;
    audio.volume = 0.2;
    audio.play().catch(() => {
      console.warn('Audio play was prevented by browser policy.');
    });
    scheduleGlitch();
  });

  // Redirect back
  returnBtn.addEventListener('click', () => {
    window.location.href = 'https://jmilescaldwell.github.io';
  });

  // Ensure audio unblocked on any click
  window.addEventListener('click', function enableAudio() {
    audio.muted = false;
    window.removeEventListener('click', enableAudio);
  });

  // One “glitch” flash, with a 30% chance of a rapid second flash
  function doGlitch() {
    // First flash
    glitch.style.opacity = '1';
    setTimeout(() => { glitch.style.opacity = '0'; }, 80);

    // 20% chance of double-flash
    if (Math.random() < 0.2) {
      setTimeout(() => {
        glitch.style.opacity = '1';
        setTimeout(() => { glitch.style.opacity = '0'; }, 80);
      }, 120);
    }

    // Schedule next
    scheduleGlitch();
  }

  function scheduleGlitch() {
    // Next glitch in 2–5 seconds randomly
    const delay = 2000 + Math.random() * 3000;
    setTimeout(doGlitch, delay);
  }
</script>
