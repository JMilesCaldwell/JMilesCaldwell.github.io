<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Commoner Generator</title>
  <link rel="icon" href="/resources/compass_favicon_32x32.png" type="image/png">
  <!-- GOOGLE FONTS -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link 
    href="https://fonts.googleapis.com/css2?family=Almendra&family=Cinzel:wght@400;700&display=swap" 
    rel="stylesheet"
  >
  <style>
    /* BASIC STYLES */
    body {
      margin: 0;
      background: url('resources/commoner.png') no-repeat center center fixed;
      background-size: cover;
      color: #FAF4E0;
      font-family: 'Almendra', serif;
      text-align: center;
    }
    h1, h2, h3 {
      font-family: 'Cinzel', serif;
      margin-bottom: 0.5rem;
    }
    .fancy-divider {
      margin: 0.25rem 0 1rem;
      font-size: 1.2rem;
      text-align: center;
    }
    .fancy-divider::after {
      content: "✦ ✧ ✦";
      color: #8B0000;
      letter-spacing: 0.5rem;
    }
    .container {
      max-width: 800px;
      margin: 2rem auto;
      background: rgba(0, 0, 0, 0.7);
      padding: 2rem;
      border-radius: 10px;
    }
    label {
      display: inline-block;
      width: 150px;
      margin-right: 8px;
      font-weight: bold;
    }
    select, input[type="text"], input[type="number"] {
      margin-bottom: 1rem;
      padding: 0.2rem;
      font-size: 1rem;
      background-color: #fff9ed;
      color: #333;
      border: 1px solid #999;
      font-family: 'Almendra', serif;
    }
    .button {
      background-color: #8B0000;
      color: #fff;
      border: none;
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-size: 1rem;
      margin: 0.5rem 0;
      font-family: 'Cinzel', serif;
    }
    .button:hover {
      background-color: #6B0000;
    }
    .output {
      margin-top: 2rem;
      padding: 1rem;
      border: 1px solid #aaa;
      background-color: #fff5e6;
      color: #333;
    }
    .footer {
      margin-top: 3rem;
      font-size: 0.9rem;
      color: #666;
      font-family: 'Almendra', serif;
    }
    /* Hide print button until a character is generated */
    #printButton {
      display: none;
    }
    @media print {
      body * { visibility: hidden !important; }
      #output, #output * { visibility: visible !important; }
      #output { position: absolute; left: 0; top: 0; width: 100%; }
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Commoner Generator</h1>
  <div class="fancy-divider"></div>

  <!-- HOME BUTTON -->
  <button class="button" onclick="window.location.href='https://jmilescaldwell.github.io/index.html'">
    Home
  </button>
  
  <p>
    Generate a “level 0” or “level 0.5” commoner (including the new <em>Mage</em> background for a magical flavour).
  </p>
  
  <!-- CHARACTER CREATION FORM -->
  <div id="creation-form">
    <!-- Character Name -->
    <div>
      <label for="name-input">Name:</label>
      <input type="text" id="name-input" placeholder="Enter or randomise" />
      <button class="button" onclick="randomName()">Random</button>
    </div>
    <!-- Race Selection -->
    <div>
      <label for="race-select">Race:</label>
      <select id="race-select">
        <option value="">-- Choose --</option>
      </select>
      <button class="button" onclick="randomRace()">Random</button>
    </div>
    <!-- Background Selection -->
    <div>
      <label for="background-select">Background:</label>
      <select id="background-select">
        <option value="">-- Choose --</option>
      </select>
      <button class="button" onclick="randomBackground()">Random</button>
    </div>
    <!-- Level Selection -->
    <div>
      <label for="level-select">Level:</label>
      <select id="level-select">
        <option value="0">0 (True Commoner)</option>
        <option value="0.5">0.5 (Slightly Skilled)</option>
      </select>
    </div>
    <!-- Ability Scores -->
    <div>
      <label>Ability Scores:</label><br/>
      <button class="button" onclick="rollAbilityScores()">Roll (4d6 drop lowest)</button>
      <button class="button" onclick="standardArray()">Standard Array (15,14,13,12,10,8)</button>
      <div id="abilities-display" style="margin-top:0.5rem;"></div>
    </div>
    <!-- Generate Character & Full Random -->
    <div>
      <button class="button" onclick="generateCharacter()">Generate Character</button>
      <button class="button" onclick="fullRandom()">Full Random</button>
    </div>
  </div>
  
  <!-- OUTPUT -->
  <div id="output" class="output" style="display: none;">
    <h2 id="charName" style="margin-top: 0;"></h2>
    <div class="fancy-divider"></div>
    <div id="charRace"></div>
    <div id="charBackground"></div>
    <div id="charAbilityScores"></div>
    <div id="charProficiencies"></div>
    <div id="charLanguages"></div>
    <div id="charEquipment"></div>
    <hr/>
    <div id="charTraits" style="margin-top:1rem;"></div>
  </div>
  
  <!-- PRINT BUTTON -->
  <button class="button" id="printButton" onclick="window.print()">Print</button>
  
  <!-- OGL NOTICE -->
  <div class="footer">
    <h3>Open Game License</h3>
    <p>
      This work includes material taken from the 5e System Reference Document (SRD),
      © 2016, Wizards of the Coast, Inc. and is covered by the 
      <strong>Open Game License, Version 1.0a</strong>.
      <br/><br/>
      <em>
      OPEN GAME LICENSE Version 1.0a<br>
      The following text is the property of Wizards of the Coast, Inc. and is Copyright 
      2000 Wizards of the Coast, Inc ("Wizards"). All Rights Reserved.<br>
      1. Definitions: (a)"Contributors" means the copyright...
      <a href="https://media.wizards.com/2016/downloads/DND/SRD-OGL_V5.1.pdf" target="_blank">Read the full license</a>.
      </em>
    </p>
  </div>
</div>

<script>
  // ---------- Global Arrays and Constants ----------
  let FIRST_NAMES = [];
  let LAST_NAMES = [];
  
  const RAW_NAMES = [
    // Southern-Inspired Names
    "Abby Sue", "Adelaide Rae", "Alvin Lee", "Annabeth Lou", "Arlen James",
    "Bea Mae", "Beckett Mose", "Belle Jo", "Bobby Ray", "Bonnie Faye",
    "Buck Harding", "Clarabelle", "Claudette Pearl", "Clinton Dean", "Cordelia Grace",
    "Darcy Lynn", "Darlene Rose", "Delilah Kay", "Duke Earle", "Ella Beth",
    "Etta Lou", "Flannery Kate", "Florence Jean", "Forrest Wade", "Franklin Dale",
    "Freddie Sue", "Grady Lance", "Hannah Leigh", "Harper June", "Hollis Reed",
    "Ida Mae", "Iris Jeanine", "Jebediah Johnson", "Jessaline Hamilton", "Jolene Pearl",
    "Judd Carter", "Kady Lynne", "Kinley Grace", "Kirby Wyatt", "Lambert Clyde",
    "Lavinia Belle", "Leona Rae", "Lester Hoyt", "Lila Rose", "Loretta Gale",
    "Louis Hunter", "Lucille Anne", "Mack Travis", "Marlena Jo", "Maude Elaine",
    "Memphis Dale", "Merrilee Lou", "Millie Joyce", "Nola Paige", "Orabelle Jane",
    "Orin Mac", "Patsy Lee", "Peyton Vance", "Presley Dawn", "Reba Quinn",
    "Reuben Clive", "Rosalee Lynn", "Sadie Beth", "Sheridan Clay", "Sonny Ralph",
    "Stella Jean", "Sully Dean", "Susannah Ray", "Tanner Royce", "Tara Jo",
    "Tate Abel", "Tennessee Wells", "Tessa Rae", "Travis Wade", "Trixie Lynn",
    "Tyson Lee", "Velma Kay", "Vernon Todd", "Violet June", "Waylon Clark",
    "Waverly Lane", "Willodean Miller", "Winnie Belle", "Zelda Ruth",
    // Cajun/French-Inspired Names
    "Aimée-Noelle", "Alphonsine", "Amélie Colette", "Antoine Reynaud", "Armand Gautier",
    "Beaufort \"Beau\"", "Bernadette Delacroix", "Camille Dupont", "Cécile Marin", "Chantal Boudreaux",
    "Charlot Dupuis", "Claudine Désirée", "Corinne Lajoie", "Delphine Robichaux", "Édouard Babineaux",
    "Eloise Broussard", "Estelle LaFleur", "Étienne Dubois", "Evangeline Badeaux", "Félix Morel",
    "Florent Dupre", "Gaëtan Renault", "Gervais Bouchard", "Honoré Lavigne", "Jacques Landry",
    "Jean-Baptiste Robillard", "Jean-Luc Martine", "Jolie Esmé", "Leonie Arcenaux", "Lisette Dauphin",
    "Lucette Violette", "Lucien Armand", "Madelon Artois", "Margot Pellerin", "Marius Gaspard",
    "Mathilde Perreault", "Maurice LeClerc", "Odette Marchand", "Pierre Lafayette", "Remy Roux",
    "Sylvain Thibodeaux", "Thierry Gaspard",
    // German-Inspired Names
    "Adelheid Roth", "Albert Drechsler", "Anneliese Becker", "Bastian Jäger", "Beate Vogel",
    "Benedikt Kraus", "Bernd Baumann", "Brigitte Neumann", "Carla Meier", "Christa Zielke",
    "Dieter Vogel", "Dorothea Hauer", "Eberhard Zeigler", "Edith Schuster", "Elias Drescher",
    "Erika Sasse", "Ernst Kaufmann", "Ferdinand Braun", "Frieda Hoffman", "Friedrich Schaller",
    "Gerda Mayer", "Gerhard Weber", "Gertrud Hauck", "Giselher Bauer", "Gudrun Fischer",
    "Hans König", "Heide Rösler", "Heinrich Beck", "Helga Möbius", "Hilde Schaefer",
    "Ingrid Pfaff", "Johann Albrecht", "Jörg Vogt", "Karin Ziegler", "Karl Kempf",
    "Katharina Scholz", "Konrad Schmitt", "Liesel Engel", "Marlene Wilke", "Otto Kuhl",
    "Sigmund Richter", "Stefan Eberhardt", "Ulrike Werner",
    // Finnish-Inspired Names
    "Aino Tuulikki", "Aleksi Heikkinen", "Alina Koivunen", "Anja Saarinen", "Arto Mikkonen",
    "Eelis Pennanen", "Eero Ranta", "Elina Kaarina", "Emilia Järvinen", "Esko Niemi",
    "Hanna Vartiainen", "Heikki Pulkkinen", "Henna Korhonen", "Ilkka Pennanen", "Johanna Heikkilä",
    "Joonas Rantala", "Juha Partanen", "Juho Virtanen", "Kaarina Salminen", "Kaisa Kurki",
    "Kalevi Mäkinen", "Katja Peltonen", "Kristiina Väisänen", "Lasse Lehtonen", "Liisa Erkkilä",
    "Maarit Halonen", "Matti Aalto", "Miika Nurmi", "Mikko Korpi", "Niko Hautala",
    "Noora Rinne", "Olli Kukkonen", "Orvokki Paananen", "Paavo Kallio", "Petri Vainio",
    "Riikka Mustonen", "Saara Piirainen", "Sanna Koivu", "Seppo Valtonen", "Tapio Leppänen",
    "Taru Korpela", "Tiina Koski", "Tuula Mäkelä", "Vilma Pelkonen",
    // Additional Mix & Misc. Names
    "Alina Reznik", "Beck Mullins", "Bernard Lamar", "Celestine Broussard", "Darla Gros",
    "Darrell Louviere", "Donovan Lee", "Ervin Halvari", "Eulalie Chauvin", "Felicia Merle",
    "Finn Jääskeläinen", "Gaston Lavigne", "Gunther Ernst", "Heike Näslund", "Hilda Lamm",
    "Inka Lampinen", "Jaana Pihkala", "Jesse-Mae Glover", "Kasper Autio", "Katrin Müller",
    "Kylah Beth", "Lafayette Boudreau", "Lavinia Faye", "Lola Mignon", "Lorelei Stein",
    "Louella Hicks", "Luke Monroe", "Maija Heiskanen", "Manfred Erber", "Marceline Arnaud",
    "Marja-Leena Koivu", "Mason Wyatt", "Mireille Malveaux", "Neville Fontenot", "Odile Champoux",
    "Oscar Wendel", "Pearl Nettles", "Priscilla Joplin", "Reinhardt Faust", "Risto Vaananen",
    "Rudolf Meissner", "Ruth Ellen", "Sade Rantanen", "Sallie June", "Severin Vogel",
    "Signe Ollila", "Suzette Armond", "Timo Harkonen", "Toby Luther", "Vera Gail",
    "Viktoria Haas", "Ville Rautio", "Wilhelm Schuster", "Winifred Lane",
    // Arabic-Inspired Names
    "Aaliyah Noor", "Abdullah Kareem", "Aisha Farah", "Amir Rashid", "Basim Nabil",
    "Dalia Hassan", "Faisal Zayed", "Hadia Salim", "Ibrahim Mustafa", "Jamila Rahim",
    "Khalid Mansoor", "Latifa Zain", "Maha Karim", "Nadia Saif", "Omar Aziz",
    "Rania Malik", "Samiya Rahim", "Tariq Jamil", "Yasmin Qasim", "Zainab Mustafa",
    "Samira Mustafa", "Tariq Al-Farsi", "Amina Nasir", "Rahim Malik", "Zayd Saidi",
    "Zayd Aziz", "Hasan Al-Farsi", "Layla Qasim", "Hasan Hassan", "Jalil Kareem",
    "Farid Hassan", "Noor Hassan", "Jalil Saidi", "Amina Malik", "Noor Kareem",
    "Samira Nasir", "Farid Al-Farsi", "Rania Malik", "Farid Zain", "Amina Al-Farsi",
    "Rahim Al-Farsi", "Jalil Al-Farsi", "Samira Al-Farsi",
    // Phoenician-Inspired Names
    "Adoniram Phoenicus", "Astarte Elissar", "Eshmunazar Aram", "Hannibal Melqart", "Illyris Maron",
    "Mago Dido", "Melqart Bennet", "Pygmalion Thamus", "Qedar Amir", "Saphira Delmar",
    "Sidon Asher", "Tamaris Lydon", "Zimrath Salim", "Canaan Barak", "Hannibal Carthage",
    "Barak Melqart", "Sidon Phoenikus", "Hiram Thamus", "Eshmun Phoenikus", "Zimri Phoenikus",
    "Malqat Melqart", "Tanit Carthago", "Zimri Lydon", "Baal Dido", "Sidon Thamus",
    "Elissa Thamus", "Barak Thamus", "Malqat Hanno", "Sidon Lydon", "Eshmun Hanno", "Elissa Carthago",
    "Malqat Carthago", "Baal Zidonian", "Tanit Hanno", "Zimri Carthago", "Adon Zidonian",
    "Adon Aram", "Barak Phoenikus", "Zimri Qart", "Hiram Melqart", "Adon Dido", "Tanit Dido", "Eshmun Dido",
    // Southeast Asian-Inspired Names
    "Ananda Suri", "Budi Santoso", "Chai An", "Dewi Kartika", "Hana Putri",
    "Indra Wijaya", "Laksmi Dewi", "Nanda Putra", "Putri Ayu", "Raden Wijaya",
    "Sari Wulan", "Sri Mulyani", "Surya Adi", "Tika Prasetya", "Wayan Eka",
    "Yuni Setia", "Guntur Wijaya", "Murni Kartika", "Guntur Santoso", "Bayu Kartika",
    "Jaya Kartika", "Eka Wulan", "Putra Surya", "Jaya Prasetyo", "Guntur Adi",
    "Agung Lestari", "Komang Rahardjo", "Murni Rahardjo", "Guntur Lestari", "Komang Wulan",
    "Wayan Eka", "Agung Adi", "Bayu Adi", "Komang Dewi", "Jaya Rahardjo", "Putra Prasetyo",
    "Jaya Santoso", "Agung Santoso", "Komang Wijaya", "Putra Wijaya", "Bayu Wijaya", "Komang Kartika", "Bayu Surya",
    // Overly British (Posh) Names
    "Algernon Fitzroy", "Archibald Montague", "Bartholomew Percival", "Beauregard Kensington",
    "Benedict Sterling", "Cecil Pemberton", "Chesterfield Wainscott", "Clarence Cavendish",
    "Cornelius Ashford", "Cyril Pembroke", "Edmund Winthrop", "Fitzwilliam Blackwood",
    "Geoffrey Harrington", "Harrington Worthington", "Lancelot Ashcroft", "Montgomery Fairfax",
    "Percival Haverhill", "Reginald Beaumont", "Rupert Forsythe", "Thaddeus Wellington",
    "Wellington Barrington", "Wilfred Kingsley", "Winston Radcliffe", "Ainsley Montford",
    "Beaumont Fitzroy", "Cedric Kingswell", "Ferguson Worth", "Giles St John",
    "Horatio Pembroke", "Ignatius Cavendish", "Jasper Kingsley", "Maximilian Ashford",
    "Nigel Wrenford", "Oswald Montgomery", "Quentin Blackwood", "Sebastian Waverly",
    "Tristram Pemberton"
  ];
  
  // Parse each RAW_NAMES entry into FIRST_NAMES and LAST_NAMES
  function parseName(fullName) {
    const trimmed = fullName.trim();
    if (!trimmed) return null;
    const parts = trimmed.split(/\s+/);
    if (parts.length === 1) {
      return { first: parts[0].replace(/"/g, ""), last: "" };
    } else {
      return { first: parts[0].replace(/"/g, ""), last: parts[parts.length - 1].replace(/"/g, "") };
    }
  }
  
  RAW_NAMES.forEach(entry => {
    const parsed = parseName(entry);
    if (parsed) {
      if (parsed.first) FIRST_NAMES.push(parsed.first);
      if (parsed.last) LAST_NAMES.push(parsed.last);
    }
  });
  
  // ---------- Races ----------
  const RACES = [
    {
      name: "Dwarf",
      abilityScoreBonuses: { CON: 2 },
      speed: 25,
      features: [
        "Darkvision (60 ft)",
        "Dwarven Resilience (adv. on poison saves)",
        "Dwarven Combat Training",
        "Stonecunning"
      ],
      languages: ["Common", "Dwarvish"]
    },
    {
      name: "Elf",
      abilityScoreBonuses: { DEX: 2 },
      speed: 30,
      features: [
        "Darkvision (60 ft)",
        "Keen Senses (proficiency in Perception)",
        "Fey Ancestry (adv. on charm saves)",
        "Trance"
      ],
      languages: ["Common", "Elvish"]
    },
    {
      name: "Halfling",
      abilityScoreBonuses: { DEX: 2 },
      speed: 25,
      features: [
        "Lucky (reroll 1s on attack/ability/saving throws)",
        "Brave (adv. on fear saves)",
        "Halfling Nimbleness"
      ],
      languages: ["Common", "Halfling"]
    },
    {
      name: "Human",
      abilityScoreBonuses: { STR: 1, DEX: 1, CON: 1, INT: 1, WIS: 1, CHA: 1 },
      speed: 30,
      features: [],
      languages: ["Common", "One Extra Language of your choice"]
    },
    {
      name: "Dragonborn",
      abilityScoreBonuses: { STR: 2, CHA: 1 },
      speed: 30,
      features: [
        "Draconic Ancestry",
        "Breath Weapon",
        "Damage Resistance (based on ancestry)"
      ],
      languages: ["Common", "Draconic"]
    },
    {
      name: "Gnome",
      abilityScoreBonuses: { INT: 2 },
      speed: 25,
      features: [
        "Darkvision (60 ft)",
        "Gnome Cunning (adv. on mental saves vs. magic)"
      ],
      languages: ["Common", "Gnomish"]
    },
    {
      name: "Half-Elf",
      abilityScoreBonuses: { CHA: 2, PLUS_TWO_OTHERS: 1 },
      speed: 30,
      features: [
        "Darkvision (60 ft)",
        "Fey Ancestry (adv. on charm saves)",
        "Skill Versatility (proficiency in two skills)"
      ],
      languages: ["Common", "Elvish", "One Extra Language"]
    },
    {
      name: "Half-Orc",
      abilityScoreBonuses: { STR: 2, CON: 1 },
      speed: 30,
      features: [
        "Darkvision (60 ft)",
        "Relentless Endurance (once per long rest)",
        "Savage Attacks"
      ],
      languages: ["Common", "Orc"]
    },
    {
      name: "Tiefling",
      abilityScoreBonuses: { CHA: 2, INT: 1 },
      speed: 30,
      features: [
        "Darkvision (60 ft)",
        "Hellish Resistance (resist fire)",
        "Infernal Legacy"
      ],
      languages: ["Common", "Infernal"]
    }
  ];
  
  // ---------- Backgrounds ----------
  const BACKGROUNDS = [
    {
      name: "Acolyte",
      skillProficiencies: ["Insight", "Religion"],
      languages: ["Two of your choice"],
      equipment: [
        "Holy symbol",
        "Prayer book or prayer wheel",
        "5 sticks of incense",
        "Vestments",
        "Set of common clothes",
        "Belt pouch containing 15 gp"
      ],
      feature: "Shelter of the Faithful",
      featureDesc: "As an Acolyte, you command the respect of those who share your faith. You can perform religious ceremonies and call upon fellow adherents for shelter and support, though you must uphold your religion’s practices.",
      nicknames: ["Chant", "Chapel", "Faith", "Lumen", "Reverie"]
    },
    {
      name: "Criminal/Spy",
      skillProficiencies: ["Deception", "Stealth"],
      equipment: [
        "Crowbar",
        "Set of dark common clothes including hood",
        "Belt pouch containing 15 gp"
      ],
      feature: "Criminal Contact",
      featureDesc: "You have a reliable contact within a criminal network. You know how to send and receive messages discreetly.",
      nicknames: ["Shade", "Slick", "Pockets", "Rook", "Whisper"]
    },
    {
      name: "Folk Hero",
      skillProficiencies: ["Animal Handling", "Survival"],
      equipment: [
        "Set of artisan's tools (one of your choice)",
        "Shovel",
        "Iron pot",
        "Set of common clothes",
        "Belt pouch containing 10 gp"
      ],
      feature: "Rustic Hospitality",
      featureDesc: "You blend with the common folk. Locals may offer shelter or aid when you need it most.",
      nicknames: ["Buck", "Rusty", "Spotts", "Sarge", "Oakie"]
    },
    {
      name: "Guild Artisan (Guild Merchant)",
      skillProficiencies: ["Insight", "Persuasion"],
      languages: ["One of your choice"],
      equipment: [
        "Set of artisan's tools (one of your choice)",
        "Letter of introduction from your guild",
        "Set of traveller's clothes",
        "Belt pouch containing 15 gp"
      ],
      feature: "Guild Membership",
      featureDesc: "Your guild provides lodging, food, and political support when needed.",
      nicknames: ["Hammer", "Chisel", "Scribe", "Barter", "Ledger"]
    },
    {
      name: "Hermit",
      skillProficiencies: ["Medicine", "Religion"],
      equipment: [
        "Scroll case stuffed with study notes or prayers",
        "Winter blanket",
        "Set of common clothes",
        "Herbalism kit",
        "5 gp"
      ],
      feature: "Discovery",
      featureDesc: "Your seclusion has unveiled a unique truth about the cosmos—one that might shape your destiny.",
      nicknames: ["Quiet", "Wisp", "Moony", "Muse", "Cloister"]
    },
    {
      name: "Noble",
      skillProficiencies: ["History", "Persuasion"],
      equipment: [
        "Set of fine clothes",
        "Signet ring",
        "Scroll of pedigree",
        "Purse containing 25 gp"
      ],
      feature: "Position of Privilege",
      featureDesc: "Your noble birth carries authority. Nobles and commoners alike treat you with due respect.",
      nicknames: ["Lordy", "Duchess", "Grace", "Count", "Regal"]
    },
    {
      name: "Outlander",
      skillProficiencies: ["Athletics", "Survival"],
      languages: ["One of your choice"],
      equipment: [
        "Staff",
        "Hunting trap",
        "Trophy from a slain animal",
        "Set of traveller's clothes",
        "Belt pouch containing 10 gp"
      ],
      feature: "Wanderer",
      featureDesc: "You possess an exceptional memory for geography and can recall terrain and settlement layouts with ease.",
      nicknames: ["Tracks", "Wild", "Hawk", "Cairn", "Scout"]
    },
    {
      name: "Sage",
      skillProficiencies: ["Arcana", "History"],
      equipment: [
        "Bottle of black ink",
        "Quill",
        "Small knife",
        "Letter from a deceased colleague",
        "Set of common clothes",
        "Belt pouch containing 10 gp"
      ],
      feature: "Researcher",
      featureDesc: "If you lack specific lore, you usually know where to find it. Your knowledge might be hidden or hard to come by.",
      nicknames: ["Quill", "Stacks", "Owl", "Doc", "Booker"]
    },
    {
      name: "Mage",
      skillProficiencies: ["Arcana", "History"],
      equipment: [
        "Quarterstaff (arcane focus for Mage Bolt)",
        "Spellbook or arcane notes",
        "Set of common clothes",
        "Belt pouch containing 10 gp"
      ],
      feature: "Arcane Initiate",
      featureDesc: "You’ve begun to tap into magic, channeling an arcane bolt through your staff instead of physical attacks.",
      nicknames: ["Arc", "Wizard", "Spark", "Boom", "Focus"]
    },
    {
      name: "Sailor",
      skillProficiencies: ["Athletics", "Perception"],
      equipment: [
        "Belaying pin (club)",
        "50 feet of silk rope",
        "Lucky charm",
        "Set of common clothes",
        "Belt pouch containing 10 gp"
      ],
      feature: "Ship's Passage",
      featureDesc: "Your seafaring skills secure free passage aboard ships—if you assist the crew along the way.",
      nicknames: ["Salty", "Anchor", "Rudder", "Knotty", "Seabreeze"]
    },
    {
      name: "Soldier",
      skillProficiencies: ["Athletics", "Intimidation"],
      equipment: [
        "Insignia of rank",
        "Trophy from a fallen enemy",
        "Set of bone dice or a deck of cards",
        "Set of common clothes",
        "Belt pouch containing 10 gp"
      ],
      feature: "Military Rank",
      featureDesc: "Your former military rank carries weight with those still loyal to your old unit.",
      nicknames: ["Sarge", "Brass", "Boots", "Vets", "Gunner"]
    },
    {
      name: "Urchin",
      skillProficiencies: ["Sleight of Hand", "Stealth"],
      equipment: [
        "Small knife",
        "City map",
        "Pet mouse",
        "Token of your parents",
        "Set of common clothes",
        "Belt pouch containing 10 gp"
      ],
      feature: "City Secrets",
      featureDesc: "You know urban shortcuts and hidden pathways—enabling rapid travel through cities.",
      nicknames: ["Rat", "Stray", "Alley", "Gutters", "Pebbles"]
    },
    {
      name: "Tanner",
      skillProficiencies: ["Survival", "Nature"],
      languages: [],
      equipment: [
        "Small set of tanning tools",
        "Sturdy apron",
        "A prized cured hide",
        "Set of common clothes",
        "Belt pouch containing 5 gp"
      ],
      feature: "Leatherwise",
      featureDesc: "You can instantly judge the quality of hides and locate buyers even in remote settlements.",
      nicknames: ["Hide", "Skins", "Tannic", "Pelt", "Sinew"]
    },
    {
      name: "Alchemist",
      skillProficiencies: ["Arcana", "Medicine"],
      languages: [],
      equipment: [
        "Alchemist’s kit (flasks, mortar & pestle)",
        "Weathered notebook of formulas",
        "Reagent-stained common clothes",
        "Belt pouch containing 10 gp"
      ],
      feature: "Experimental Brewer",
      featureDesc: "Local apothecaries or herbalists often provide discounts in hopes that your next discovery is lucrative.",
      nicknames: ["Vial", "Fume", "Brew", "Pestle", "Tonic"]
    },
    {
      name: "Miner",
      skillProficiencies: ["Athletics", "Perception"],
      languages: [],
      equipment: [
        "Pickaxe",
        "Lantern and flask of oil",
        "Sample of precious ore",
        "Sturdy boots and rugged clothes",
        "Belt pouch containing 10 gp"
      ],
      feature: "Tunnel Instinct",
      featureDesc: "You have an uncanny ability to sense structural weaknesses underground.",
      nicknames: ["Pick", "Sparky", "Ore", "Dusty", "Coal"]
    },
    {
      name: "Beast Tamer",
      skillProficiencies: ["Animal Handling", "Nature"],
      languages: [],
      equipment: [
        "Length of rope",
        "Carved token of a favourite beast",
        "Supply of dried meat",
        "Simple outdoor attire",
        "Belt pouch containing 5 gp"
      ],
      feature: "Animal Rapport",
      featureDesc: "Animals trust you instinctively; locals seek your help with unruly creatures.",
      nicknames: ["Buck", "Wrangler", "Whistle", "Critter", "Hoof"]
    },
    {
      name: "Chandler",
      skillProficiencies: ["Persuasion", "Investigation"],
      languages: [],
      equipment: [
        "Block of wax",
        "Candle mould and tinderbox",
        "Sales ledger",
        "Plain, neat clothes",
        "Belt pouch containing 7 gp"
      ],
      feature: "Keeper of Light",
      featureDesc: "You know how to make reliable candles and source cheap tallow or beeswax.",
      nicknames: ["Candle", "Wax", "Wick", "Tallow", "Glow"]
    },
    {
      name: "Cooper",
      skillProficiencies: ["History", "Sleight of Hand"],
      languages: [],
      equipment: [
        "Cooper’s hammer and iron hoops",
        "Self-crafted small cask",
        "Serviceable working clothes",
        "Belt pouch containing 10 gp"
      ],
      feature: "Well-Bound Containers",
      featureDesc: "Your barrels and crates are secure; you can spot any signs of tampering at a glance.",
      nicknames: ["Barrel", "Hoops", "Ring", "Crater", "Tapper"]
    },
    {
      name: "Cartwright",
      skillProficiencies: ["Carpenter’s Tools", "History"],
      languages: [],
      equipment: [
        "Woodworking toolkit",
        "Miniature model cart",
        "Sturdy common clothes",
        "Belt pouch containing 10 gp"
      ],
      feature: "Roadwise",
      featureDesc: "Your experience building and repairing carts gives you insight into travel and maintenance.",
      nicknames: ["Axle", "Spokes", "Wheel", "Lumber", "Waggon"]
    },
    {
      name: "Scribe",
      skillProficiencies: ["History", "Investigation"],
      languages: ["One of your choice"],
      equipment: [
        "Quill and jar of ink",
        "Sheaf of parchment",
        "Personal scribble log",
        "Simple, tidy clothes",
        "Belt pouch containing 5 gp"
      ],
      feature: "Academic Access",
      featureDesc: "Your writing skills grant you easier access to archives and private collections.",
      nicknames: ["Quill", "Ink", "Scroll", "Lexi", "Page"]
    },
    {
      name: "Glassblower",
      skillProficiencies: ["Arcana", "Perception"],
      languages: [],
      equipment: [
        "Glassblowing pipe",
        "Wrapped glass trinket",
        "Sturdy goggles",
        "Common clothes",
        "Belt pouch containing 5 gp"
      ],
      feature: "Fragile Eye",
      featureDesc: "Your discerning eye detects flaws in glass—making you a trusted judge among artisans.",
      nicknames: ["Fragile", "Pane", "Spark", "Torch", "Crystal"]
    },
    {
      name: "Jeweller",
      skillProficiencies: ["Insight", "Sleight of Hand"],
      languages: [],
      equipment: [
        "Loupe or magnifying lens",
        "Pouch of assorted uncut gemstones",
        "Smart, modest clothes",
        "Belt pouch containing 15 gp"
      ],
      feature: "Stone Appraisal",
      featureDesc: "You can quickly assess the value of gems and precious metals.",
      nicknames: ["Shine", "Facet", "Gem", "Pearl", "Rocky"]
    },
    {
      name: "Shipwright",
      skillProficiencies: ["Athletics", "Carpenter’s Tools"],
      languages: [],
      equipment: [
        "Small mallet and chisel",
        "Piece of driftwood with etched diagram",
        "Rugged clothes",
        "Belt pouch containing 10 gp"
      ],
      feature: "Maritime Specialist",
      featureDesc: "Ship captains trust your expertise; you can assess a vessel’s seaworthiness at a glance.",
      nicknames: ["Timbers", "Hull", "Dock", "Anchor", "Mast"]
    },
    {
      name: "Bowyer/Fletcher",
      skillProficiencies: ["Nature", "Perception"],
      languages: [],
      equipment: [
        "Bundle of feathers and arrow shafts",
        "Small bowyer’s toolkit",
        "Workable common clothes",
        "Belt pouch containing 5 gp"
      ],
      feature: "Arrow Precision",
      featureDesc: "You craft serviceable arrows from natural materials and quickly judge the quality of bows.",
      nicknames: ["Arrow", "Feather", "Quiver", "Bowstring", "Fletch"]
    },
    {
      name: "Cobbler",
      skillProficiencies: ["Sleight of Hand", "Insight"],
      languages: [],
      equipment: [
        "Cobbler’s kit (awl, hammer, patches)",
        "Well-worn boots you’ve made",
        "Common clothes",
        "Belt pouch containing 8 gp"
      ],
      feature: "Sure-Footed",
      featureDesc: "You excel at fitting boots and tracking individuals by their unique footprints.",
      nicknames: ["Boots", "Soles", "Stitch", "Tap", "Tread"]
    },
    {
      name: "Farmer",
      skillProficiencies: ["Animal Handling", "Nature"],
      languages: [],
      equipment: [
        "Hoe or sickle",
        "Small pouch of seeds",
        "Wide-brimmed straw hat",
        "Sturdy clothes",
        "Belt pouch containing 5 gp"
      ],
      feature: "Local Harvest",
      featureDesc: "You know how to grow and gather crops, earning respect among rural folk.",
      nicknames: ["Seed", "Haystack", "Plow", "Row", "Scythe"]
    },
    {
      name: "Fisher",
      skillProficiencies: ["Survival", "Perception"],
      languages: [],
      equipment: [
        "Simple fishing rod or hand line",
        "Small tackle box",
        "Net",
        "Waterproof boots",
        "Belt pouch containing 5 gp"
      ],
      feature: "Waterside Hospitality",
      featureDesc: "Your knack for fishing secures daily rations, and fellow fishers are friendly.",
      nicknames: ["Fin", "Hook", "Line", "Nets", "Minnow"]
    },
    {
      name: "Mercenary Captain",
      skillProficiencies: ["Athletics", "Persuasion"],
      languages: ["One of your choice"],
      equipment: [
        "Finely maintained military uniform",
        "Mercenary company insignia",
        "Well-worn battlefield map",
        "Belt pouch containing 20 gp"
      ],
      feature: "Commanding Presence",
      featureDesc: "Your reputation rallies former comrades in battle, providing valuable assistance when needed.",
      nicknames: ["Captain", "Commander", "Ironhand", "Chief", "Bull"]
    },
    {
      name: "Courtier",
      skillProficiencies: ["Persuasion", "Insight"],
      languages: ["Latin", "One of your choice"],
      equipment: [
        "Finely tailored court attire",
        "Signet ring bearing your family's crest",
        "Letter of introduction from a noble patron",
        "Belt pouch containing 15 gp"
      ],
      feature: "Access to Royal Privilege",
      featureDesc: "Your position at court grants you entry to powerful circles and exclusive events.",
      nicknames: ["Noble", "Lord", "Lady", "Squire", "Regent"]
    },
    {
      name: "Cartographer",
      skillProficiencies: ["Survival", "History"],
      languages: ["One of your choice"],
      equipment: [
        "Traveller's clothes",
        "Weathered journal with sketches and maps",
        "Compass and sextant",
        "Belt pouch containing 10 gp"
      ],
      feature: "Chart the Unknown",
      featureDesc: "Your journeys into uncharted lands let you recall detailed maps and sometimes uncover hidden paths.",
      nicknames: ["Scout", "Pathfinder", "Rover", "Nomad", "Wanderer"]
    },
    {
      name: "Gunsmith",
      skillProficiencies: ["Sleight of Hand", "Investigation"],
      languages: ["One of your choice"],
      equipment: [
        "Artisan's tools for firearms",
        "Vial of gunpowder",
        "Sturdy work gloves",
        "Belt pouch containing 15 gp"
      ],
      feature: "Master of Firearms",
      featureDesc: "Your expertise in early firearms allows you to mend or modify weapons quickly.",
      nicknames: ["Sparks", "Gunner", "Smith", "Blast", "Cannon"]
    },
    {
      name: "Wealthy Merchant",
      skillProficiencies: ["Persuasion", "Insight"],
      languages: ["One of your choice"],
      equipment: [
        "Ledger of business dealings",
        "Fine travelling clothes",
        "Small scale and weighing weights",
        "Belt pouch containing 25 gp"
      ],
      feature: "Trade Connections",
      featureDesc: "Your extensive network secures fair prices and safe passage; merchants and officials are inclined to assist you.",
      nicknames: ["Trader", "Broker", "Ledger", "Stonks", "Goldfinger"]
    }
  ];
  
  const PERSONALITY_TRAITS = [
    "I meticulously maintain my weapons and armour, treating each as a treasured heirloom.",
    "I harbour a secret longing for a noble life, despite my modest origins.",
    "I delight in reciting ancient proverbs and quoting obscure texts at every opportunity.",
    "I possess an unyielding loyalty to my comrades, standing by them through siege and strife.",
    "I savor the taste of fine wines and dream of lavish banquets, even in lean times.",
    "I abide by a strict code of honour, with transgressions met by swift, decisive retribution.",
    "I relish the thrill of a high-stakes wager, often risking more than I can spare.",
    "I nurture an almost obsessive penchant for collecting curious relics from my travels.",
    "I am endlessly fascinated by the intricacies of court politics, ever mindful of the balance of power.",
    "I find solace in the quiet of moonlit nights, when the clamor of the world fades into whispering shadows.",
    "I wax poetic about the art of warfare and the delicate science of strategy.",
    "I frequent the local tavern, engaging in boisterous debates with fellow adventurers.",
    "I maintain a fastidious appearance, convinced that one's bearing reflects the strength of one’s character.",
    "I harbour a persistent ambition to rise above my station, no matter the trials I must endure.",
    "I possess an insatiable curiosity for the arcane, often delving into forbidden tomes despite the risks.",
    "I remain steadfastly loyal to time-honoured traditions, even as the world around me transforms.",
    "I relish the challenge of solving riddles and puzzles, seeing them as tests of wit and mettle.",
    "I harbour a quiet disdain for ostentatious wealth and empty titles, preferring substance over show.",
    "I view every challenge as an opportunity for growth, embracing hardship as a teacher.",
    "I cherish the memory of my ancestors, speaking of them with reverence as if they walked beside me.",
    "I am known for my unwavering resolve, even in the face of overwhelming odds.",
    "I find comfort in the rituals of daily life, from morning prayers to nightly vigils.",
    "I am haunted by the ghost of a past mistake, driving me to seek redemption in every act.",
    "I secretly collect relics of ancient battles, each piece a memento of lost glory.",
    "I have a tendency to speak in a measured, deliberate tone, as if every word carries weight.",
    "I pride myself on my knowledge of heraldry and lineage, keen to trace noble bloodlines.",
    "I enjoy the art of duelling, both in verbal sparring and in combat, as a test of skill.",
    "I display a quiet melancholy, reflective of a life burdened by duty and loss.",
    "I am a firm believer in divine providence, seeing signs and miracles in everyday events.",
    "I revel in the theatre of battle, finding a strange beauty in the chaos of war.",
    "I hold conversations with great intellectuals, always seeking to expand my understanding of the world.",
    "I maintain a secret correspondence with a long-forgotten scholar, exchanging ideas and forbidden lore.",
    "I have a habit of wearing a particular token of remembrance—a locket or ring—that holds sentimental value.",
    "I am quick to offer a toast to both fortune and fate, never shying away from celebration.",
    "I speak with the authority of someone who has seen the rise and fall of empires.",
    "I am known to be unusually punctual, believing that time itself is a precious commodity.",
    "I harbour a rebellious streak, questioning established norms and challenging authority when necessary.",
    "I take pride in my ability to navigate both the wilderness and the labyrinthine corridors of power.",
    "I find deep satisfaction in crafting meticulous plans, always anticipating future moves.",
    "I am resolute in the face of betrayal, my trust hard-earned and rarely given.",
    "I often meditate on the transience of life, aware that every victory is fleeting.",
    "I am known for my stoic demeanour, rarely allowing my emotions to show even in dire moments.",
    "I have a penchant for quoting ancient wisdom, often in archaic language that others find perplexing.",
    "I maintain a disciplined routine, rising before dawn and retiring at dusk without fail.",
    "I have an eye for detail, noticing even the smallest signs of deception or treachery.",
    "I cultivate an air of mystery, never revealing too much about my past or my intentions.",
    "I possess a deep-seated sense of duty, which sometimes compels me to make personal sacrifices.",
    "I have a quiet confidence, born from years of hardship and hard-won victories.",
    "I hold a deep respect for the martial traditions of old, often seeking wisdom from veteran warriors.",
    "I display a refined taste in both literature and music, preferring the classics to modern frivolities.",
    "I am quick to defend the honour of my family, even if it means entering into conflict.",
    "I have a habit of leaving subtle clues about my true intentions in casual conversation.",
    "I find great joy in the art of letter writing, carefully crafting missives to friends and foes alike.",
    "I am known to keep a detailed diary of my exploits, chronicling every battle and encounter.",
    "I harbour a deep-seated mistrust of strangers, believing that trust must be earned through proven loyalty.",
    "I am a connoisseur of fine art and sculpture, often spending hours admiring the craftsmanship of bygone eras.",
    "I am driven by a desire for revenge against those who wronged me, a flame that never truly dies.",
    "I display a keen sense of humour, often using wit to defuse tense situations.",
    "I am unwavering in my principles, often refusing to compromise even in the face of dire consequences.",
    "I have a deep admiration for the chivalric code, striving always to emulate the knights of old.",
    "I take great care in the presentation of my words, believing that eloquence is a weapon as potent as any blade.",
    "I have a propensity to be overly cautious, carefully weighing every risk before taking action.",
    "I enjoy the challenge of solving complex problems, whether in battle strategy or in daily life.",
    "I maintain a strict separation between my public persona and my private doubts, guarding my vulnerabilities closely.",
    "I am driven by an insatiable curiosity about the natural world, often collecting specimens and observing wildlife.",
    "I have a quiet, unassuming nature that belies the fierce determination burning within me.",
    "I frequently ponder the nature of destiny, wondering if my path is preordained or carved by my own hand.",
    "I hold firm beliefs about justice and retribution, often seeking to right the wrongs I encounter.",
    "I am known to be a reliable confidant, always lending an ear to the troubled and the weary.",
    "I display a subtle defiance of authority, quietly undermining those who abuse their power.",
    "I am deeply affected by the tragedies of war, yet I persist in the belief that peace is attainable.",
    "I have a habit of performing small acts of kindness anonymously, believing that true charity needs no recognition.",
    "I am fascinated by ancient legends and myths, often incorporating their lessons into my own life.",
    "I possess an inherent sense of duty towards my community, always ready to lend my skills to a worthy cause.",
    "I am reflective and contemplative, often spending long nights in quiet introspection.",
    "I have a flair for dramatics, sometimes exaggerating my exploits to entertain and inspire others.",
    "I maintain a careful balance between ambition and humility, aware that pride can be a dangerous foe.",
    "I am driven by a sense of destiny, convinced that my actions have far-reaching consequences.",
    "I harbour a love for the rustic charm of rural life, finding beauty in simplicity and hard work.",
    "I am resolute in my belief that honor and integrity will prevail, even in the darkest of times."
  ];
  
  // ---------- Utility Functions ----------
  function populateSelect(selectId, optionsArray) {
    const selectElem = document.getElementById(selectId);
    optionsArray.forEach(opt => {
      const optionEl = document.createElement("option");
      optionEl.value = opt;
      optionEl.innerText = opt;
      selectElem.appendChild(optionEl);
    });
  }
  
  function pickRandom(array) {
    return array[Math.floor(Math.random() * array.length)];
  }
  
  function pickMultipleDistinct(array, count) {
    const copy = [...array];
    const result = [];
    if (count > copy.length) count = copy.length;
    for (let i = 0; i < count; i++) {
      const index = Math.floor(Math.random() * copy.length);
      result.push(copy[index]);
      copy.splice(index, 1);
    }
    return result;
  }
  
  function roll4d6DropLowest() {
    let scores = [];
    for (let i = 0; i < 6; i++) {
      let rolls = [0, 0, 0, 0].map(() => Math.floor(Math.random() * 6) + 1);
      rolls.sort((a, b) => a - b);
      rolls.shift(); // drop lowest
      scores.push(rolls.reduce((acc, val) => acc + val, 0));
    }
    return scores;
  }
  
  function getStandardArray() {
    return [15, 14, 13, 12, 10, 8];
  }
  
  function abilityMod(score) {
    return Math.floor((score - 10) / 2);
  }
  
  // ---------- Name Handling ----------
  function randomName() {
    if (FIRST_NAMES.length === 0 || LAST_NAMES.length === 0) {
      document.getElementById("name-input").value = "Nameless Soul";
      return;
    }
    const first = pickRandom(FIRST_NAMES);
    const last = pickRandom(LAST_NAMES);
    document.getElementById("name-input").value = first + " " + last;
  }
  
  // ---------- Race & Background Randomisers ----------
  function randomRace() {
    const randomPick = pickRandom(RACES).name;
    document.getElementById("race-select").value = randomPick;
  }
  
  function randomBackground() {
    const randomPick = pickRandom(BACKGROUNDS).name;
    document.getElementById("background-select").value = randomPick;
  }
  
  // ---------- Ability Score Handlers ----------
  let currentScores = [10, 10, 10, 10, 10, 10]; // default
  function rollAbilityScores() {
    currentScores = roll4d6DropLowest();
    displayScores();
  }
  
  function standardArray() {
    currentScores = getStandardArray();
    displayScores();
  }
  
  function displayScores() {
    const container = document.getElementById("abilities-display");
    const labels = ["STR", "DEX", "CON", "INT", "WIS", "CHA"];
    let html = "";
    currentScores.forEach((sc, i) => {
      const mod = abilityMod(sc);
      html += `${labels[i]}: <strong>${sc}</strong> (${mod >= 0 ? "+" : ""}${mod})<br/>`;
    });
    container.innerHTML = html;
  }
  
  // ---------- Weapons, Armours, and Proficiencies ----------
  const SIMPLE_WEAPONS = ["Club", "Dagger", "Handaxe", "Spear", "Sickle", "Light Crossbow"];
  const MARTIAL_WEAPONS = ["Shortsword"];
  const IMPROVISED_WEAPON = "Improvised (like a club)";
  
  const WEAPON_DATA = {
    "Club":             { damageDie: "1d4", damageType: "bludgeoning", finesse: false, ranged: false },
    "Dagger":           { damageDie: "1d4", damageType: "piercing",    finesse: true,  ranged: false },
    "Handaxe":          { damageDie: "1d6", damageType: "slashing",    finesse: false, ranged: false },
    "Spear":            { damageDie: "1d6", damageType: "piercing",    finesse: false, ranged: false },
    "Sickle":           { damageDie: "1d4", damageType: "slashing",    finesse: false, ranged: false },
    "Light Crossbow":   { damageDie: "1d8", damageType: "piercing",    finesse: false, ranged: true  },
    "Shortsword":       { damageDie: "1d6", damageType: "piercing",    finesse: true,  ranged: false },
    "Improvised (like a club)": { damageDie: "1d4", damageType: "bludgeoning", finesse: false, ranged: false },
    "Arcane Bolt (staff)": {
      damageDie: "1d6",
      damageType: "force",
      ranged: true,
      finesse: false,
      useInt: true
    }
  };
  
  const ARMORS = [
    { name: "No Armour",       baseAC: 10, dexCap: null },
    { name: "Padded Armour",   baseAC: 11, dexCap: null },
    { name: "Leather Armour",  baseAC: 11, dexCap: null },
    { name: "Hide Armour",     baseAC: 12, dexCap: 2 }
  ];
  
  const BACKGROUND_WEAPONS = {
    "Mage": ["Arcane Bolt (staff)"],
    "Sage": ["Club", "Dagger"],
    "Criminal/Spy": ["Dagger", "Shortsword", "Light Crossbow", IMPROVISED_WEAPON],
    "Folk Hero": ["Sickle", "Club", "Spear", IMPROVISED_WEAPON],
    "Outlander": ["Spear", "Handaxe", "Club"],
    "Soldier": ["Spear", "Shortsword", "Handaxe"],
    "Mercenary Captain": ["Shortsword", "Spear", "Handaxe"],
    "Courtier": ["Dagger"],
    "Cartographer": ["Club", "Handaxe", IMPROVISED_WEAPON],
    "Gunsmith": ["Dagger", IMPROVISED_WEAPON],
    "Wealthy Merchant": ["Dagger", "Club"]
  };
  
  const BACKGROUND_PROFICIENCIES = {
    "Soldier": "martial",
    "Outlander": "simple",
    "Criminal/Spy": "simple",
    "Folk Hero": "simple",
    "Sage": "simple",
    "Mage": "simple",
    "Mercenary Captain": "martial",
    "Courtier": "simple",
    "Cartographer": "simple",
    "Gunsmith": "simple",
    "Wealthy Merchant": "simple"
  };
  
  const RANDOM_EQUIPMENT_ITEMS = [
    "Mysterious Amulet", "Battered Spyglass", "Pocket Watch", "Ornate Quill",
    "Leather-bound Journal", "Faded Map", "Flask of Unknown Liquid", "Silver Pocket Mirror",
    "Vial of Rare Perfume", "Gambler's Dice", "Signet Ring", "Tattered Parchment",
    "Shimmering Dust", "Worn Leather Bookmark", "Carved Wooden Figurine", "Tiny Mysterious Key",
    "Polished Obsidian Stone", "Brass Compass", "Ancient Coin Fragment", "Richly Embroidered Cloth",
    "Cracked Mug", "Rusty Spoon", "Faded Letter", "Worn-out Boot", "Bent Nail", "Dented Shield",
    "Old Quill", "Moldy Bread Slice", "Stained Handkerchief", "Tattered Pouch", "Bent Key",
    "Frayed Rope", "Broken Lens", "Smudged Eyeglasses", "Dusty Tome", "Worn-out Page",
    "Faded Banner", "Cracked Cup", "Tarnished Spoon", "Soggy Bread", "Bent Spoon", "Dull Knife",
    "Old Candle Stub", "Chewed Pencil", "Rusted Chain", "Frayed Scarf", "Empty Flask",
    "Cracked Mirror", "Muddy Boot", "Broken Arrow", "Wobbly Chair Leg", "Stale Biscuit",
    "Crumpled Receipt", "Used Napkin", "Tattered Scroll", "Old Coin", "Scratched Lens", "Bent Nail",
    "Dusty Rope", "Chewed Gum", "Half-empty Ink Bottle", "Soggy Parchment", "Stained Letter",
    "Rusty Key", "Worn-out Book Cover", "Battered Wallet", "Crumbled Cookie", "Dull Pencil",
    "Old Doorknob", "Torn Page", "Smudged Quill", "Bent Branch", "Cracked Tile", "Mildewed Cloth",
    "Broken Bottle", "Scratched Plate", "Faded Picture", "Dented Can", "Worn-out Belt", "Frayed Cord",
    "Chewed Bootlace", "Cracked Eggshell", "Moldy Cheese Slice", "Bent Spoon", "Tarnished Medallion",
    "Cracked Platter", "Old Rag", "Splintered Wood", "Mossy Stone", "Cracked Jug", "Dented Bucket",
    "Stained Apron", "Worn-out Gloves", "Rusty Hinge", "Smudged Glass", "Mildewed Paper", "Frayed Ribbon",
    "Old Button", "Chipped Mug", "Cracked Doorknob"
  ];
  
  function addRandomEquipment(equipmentArray) {
    const extraItem = pickRandom(RANDOM_EQUIPMENT_ITEMS);
    equipmentArray.push(extraItem);
    return equipmentArray;
  }
  
  // ---------- Weapon & Armour Calculations ----------
  function isProficientInWeapon(weaponName, backgroundName) {
    const cat = BACKGROUND_PROFICIENCIES[backgroundName];
    if (!cat) return false;
    if (weaponName === "Arcane Bolt (staff)" && backgroundName === "Mage") return true;
    if (SIMPLE_WEAPONS.includes(weaponName)) return (cat === "simple" || cat === "martial");
    if (MARTIAL_WEAPONS.includes(weaponName)) return (cat === "martial");
    return false;
  }
  
  function getRandomWeaponForBackground(bgName) {
    let weaponsArray = BACKGROUND_WEAPONS[bgName];
    if (!weaponsArray) weaponsArray = ["Club", "Dagger", IMPROVISED_WEAPON];
    return pickRandom(weaponsArray);
  }
  
  function computeArmourClass(armour, dexMod) {
    const effectiveDex = (armour.dexCap !== null) ? Math.min(dexMod, armour.dexCap) : dexMod;
    return armour.baseAC + (effectiveDex > 0 ? effectiveDex : 0);
  }
  
  function computeWeaponStats(weaponName, scores, isProficient, profBonus) {
    const data = WEAPON_DATA[weaponName];
    if (!data) return null;
    const strMod = abilityMod(scores[0]);
    const dexMod = abilityMod(scores[1]);
    const intMod = abilityMod(scores[3]); // INT is index 3
    let usedMod = strMod;
    if (data.useInt) {
      usedMod = intMod;
    } else if (data.ranged) {
      usedMod = dexMod;
    } else if (data.finesse) {
      usedMod = Math.max(strMod, dexMod);
    }
    const attackBonus = usedMod + (isProficient ? profBonus : 0);
    return {
      name: weaponName,
      damageDie: data.damageDie,
      damageType: data.damageType,
      attackBonus: attackBonus,
      abilityMod: usedMod
    };
  }
  
  // ---------- Character Generation ----------
  function parseUserName(fullInput) {
    const parts = fullInput.trim().split(/\s+/);
    let firstName = "";
    let lastName = "";
    if (parts.length === 1) {
      firstName = parts[0];
    } else {
      firstName = parts[0];
      lastName = parts[parts.length - 1];
    }
    return { firstName, lastName };
  }
  
  function generateCharacter() {
    // 1. Read Name
    const rawName = document.getElementById("name-input").value.trim() || "Unnamed Hero";
    let { firstName, lastName } = parseUserName(rawName);
    
    // 2. Race & Background Selection
    const raceSelected = document.getElementById("race-select").value;
    const raceData = RACES.find(r => r.name === raceSelected);
    if (!raceData) { alert("Please select a race."); return; }
    const bgSelected = document.getElementById("background-select").value;
    const bgData = BACKGROUNDS.find(b => b.name === bgSelected);
    if (!bgData) { alert("Please select a background."); return; }
    
    // 3. Possibly add a Nickname
    if (bgData.nicknames && bgData.nicknames.length > 0 && Math.random() < 0.2) {
      const nick = pickRandom(bgData.nicknames);
      firstName += ` "${nick}"`;
    }
    
    // 4. Apply Race Ability Score Bonuses
    const ABIL_ORDER = ["STR", "DEX", "CON", "INT", "WIS", "CHA"];
    let finalScores = [...currentScores];
    for (const [ability, bonus] of Object.entries(raceData.abilityScoreBonuses)) {
      if (ability === "PLUS_TWO_OTHERS") {
        finalScores[1] += 1; // DEX
        finalScores[2] += 1; // CON
      } else {
        const idx = ABIL_ORDER.indexOf(ability);
        if (idx !== -1) finalScores[idx] += bonus;
      }
    }
    
    // 5. Select Personality Traits
    const chosenTraits = pickMultipleDistinct(PERSONALITY_TRAITS, 2);
    
    // 6. Determine Level (Proficiency Bonus)
    const levelChoice = document.getElementById("level-select").value;
    const profBonus = levelChoice === "0.5" ? 1 : 0;
    
    // 7. Pick Random Weapon & Armour
    const chosenWeapon = getRandomWeaponForBackground(bgData.name);
    const proficient = isProficientInWeapon(chosenWeapon, bgData.name);
    const weaponStats = computeWeaponStats(chosenWeapon, finalScores, proficient, profBonus);
    
    const chosenArmour = pickRandom(ARMORS);
    const dexMod = abilityMod(finalScores[1]);
    const computedAC = computeArmourClass(chosenArmour, dexMod);
    
    // 8. Compile Final Details
    const fullNameFinal = lastName ? firstName + " " + lastName : firstName;
    const featuresList = raceData.features.length ? raceData.features.map(f => `- ${f}`).join("<br/>") : "None";
    const raceLangs = raceData.languages.join(", ");
    
    // Clone and augment background equipment
    let finalEquipment = bgData.equipment.slice();
    finalEquipment = addRandomEquipment(finalEquipment);
    const bgEquipmentList = finalEquipment.map(eq => `- ${eq}`).join("<br/>");
    
    const bgSkills = bgData.skillProficiencies ? bgData.skillProficiencies.join(", ") : "None";
    const bgLangs = (bgData.languages && bgData.languages.length > 0) ? bgData.languages.join(", ") : "None";
    
    // Output the generated character
    const outputDiv = document.getElementById("output");
    outputDiv.style.display = "block";
    outputDiv.classList.add("generated");
    document.getElementById("charName").innerHTML = fullNameFinal;
    document.getElementById("charRace").innerHTML = `
      <strong>Race:</strong> ${raceData.name}<br/>
      <em>Speed:</em> ${raceData.speed} ft<br/>
      <em>Features:</em><br/> ${featuresList}
    `;
 document.getElementById("charBackground").innerHTML = `
      <strong>Background:</strong> ${bgData.name}<br/>
      <em>Skill Proficiencies:</em> ${bgSkills}<br/>
      <em>Feature:</em> <strong>${bgData.feature}</strong><br/>
      <small>${bgData.featureDesc}</small>
    `;
    document.getElementById("charAbilityScores").innerHTML = formatAbilityScores(finalScores);
    document.getElementById("charProficiencies").innerHTML = `
      <strong>Proficiencies (From BG, at Level ${levelChoice}):</strong><br/>
      Weapon Category: ${BACKGROUND_PROFICIENCIES[bgData.name] || "None"}<br/>
      Background Skills: ${bgSkills}
    `;
    document.getElementById("charLanguages").innerHTML = `
      <strong>Languages:</strong><br/>
      From Race: ${raceLangs}<br/>
      From Background: ${bgLangs}
    `;
    
    let eqHTML = `<strong>Starting Equipment:</strong><br/>${bgEquipmentList}`;
    if (weaponStats) {
      eqHTML += `
        <br/><br/><strong>Weapon:</strong> ${weaponStats.name}<br/>
        <em>Attack Bonus:</em> ${weaponStats.attackBonus >= 0 ? "+" : ""}${weaponStats.attackBonus} ${proficient ? "(proficient)" : "(not proficient)"}<br/>
        <em>Damage:</em> ${weaponStats.damageDie} ${weaponStats.abilityMod >= 0 ? "+" : ""}${weaponStats.abilityMod} (${weaponStats.damageType})
      `;
    }
    eqHTML += `<br/><br/><strong>Armour:</strong> ${chosenArmour.name} (AC = ${computedAC})`;
    document.getElementById("charEquipment").innerHTML = eqHTML;
    
    const traitsHTML = `
      <h3>Personality Traits</h3>
      <ul>
        <li>${chosenTraits[0]}</li>
        <li>${chosenTraits[1]}</li>
      </ul>
    `;
    document.getElementById("charTraits").innerHTML = traitsHTML;
    
    document.getElementById("printButton").style.display = "inline-block";
  }
  
  function formatAbilityScores(scoresArr) {
    const labels = ["STR", "DEX", "CON", "INT", "WIS", "CHA"];
    let out = "<strong>Ability Scores:</strong><br/>";
    scoresArr.forEach((sc, i) => {
      const mod = abilityMod(sc);
      out += `${labels[i]}: <strong>${sc}</strong> (${mod >= 0 ? "+" : ""}${mod})<br/>`;
    });
    return out;
  }
  
  function fullRandom() {
    randomName();
    randomRace();
    randomBackground();
    rollAbilityScores();
    generateCharacter();
  }
  
  // ---------- Initialization ----------
  window.addEventListener("DOMContentLoaded", () => {
    populateSelect("race-select", RACES.map(r => r.name));
    populateSelect("background-select", BACKGROUNDS.map(b => b.name));
  });
</script>
</body>
</html>
