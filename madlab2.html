<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Bestiary & Initiative Tracker</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Almendra&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* ——— basic theme ——— */
    body{
      margin:0;
      background:url('resources/bestiary.png') center/cover fixed no-repeat;
      color:#FAF4E0;
      font-family:'Almendra',serif;
      text-align:center;
    }
    h1{font-family:'Cinzel',serif;margin:0 0 .75rem;font-size:2rem}
    .container{
      max-width:840px;margin:2rem auto;padding:2rem;
      background:rgba(0,0,0,.7);border-radius:10px;
    }
    label{display:inline-block;font-weight:bold}
    select,.button{
      font-family:'Cinzel',serif;
      border:none;border-radius:4px;cursor:pointer;
      padding:.45rem .9rem;margin:.2rem 0;
    }
    select{
      background:#fff9ed;color:#333;border:1px solid #999;
      min-width:300px;
    }
    .button{background:#8B0000;color:#fff}
    .button:hover{background:#6B0000}
    /* ——— tracker cards ——— */
    #pinned-container{margin-top:1rem;text-align:left}
    .pinned-entry{
      position:relative;background:rgba(0,0,0,.82);
      border:1px solid #8B0000;border-radius:6px;
      padding:1rem;margin:.6rem 0;color:#FAF4E0;
    }
    .remove-btn{
      position:absolute;top:.3rem;right:.45rem;
      background:none;border:none;color:#FAF4E0;
      font-size:1.4rem;line-height:1;cursor:pointer
    }
    .controls{display:flex;gap:1rem;align-items:center;margin-bottom:.4rem}
    .controls label{font-family:'Cinzel',serif;font-size:.9rem}
    .controls input{
      width:4rem;padding:.15rem .25rem;
      border:1px solid #999;border-radius:3px;
      font:inherit;background:#fff9ed;color:#000;text-align:right
    }
    .creature-data{white-space:normal;font-size:.95rem}
    pre{margin:0;background:#fff9ed;border-radius:6px;
        padding:.8rem;color:#333;font-family:inherit}
    /* ——— print ——— */
    @media print{
      body *{visibility:hidden!important}
      #pinned-container,#pinned-container *{visibility:visible!important}
      #pinned-container{position:absolute;top:0;left:0;width:100%;padding:0}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Bestiary & Initiative Tracker</h1>

    <label for="creature-select">Select Creature:&nbsp;</label>
    <select id="creature-select"><option value="">-- choose --</option></select>
    <br>
    <button class="button" id="pin-button">Pin</button>
    <button class="button" id="add-button">Add Blank Entry</button>
    <button class="button" id="clear-button">Clear All</button>

    <div id="pinned-container"></div>
    <div id="definitions" style="display:none"></div>
  </div>

  <!-- ——— ALL CREATURE DATA ——— -->
  <script>
  /*  ============  CREATURES constant  ============ 
      ‑‑‑ This is the very same list you posted. ‑‑‑
      If you generated a YAML → HTML dump with all
      factions, paste it here.  To keep this example
      short, I'll include only two stat‑blocks.
      Replace or extend as needed.                   */
  const CREATURES = {
    "Silt": [`
<pre><strong>Silt Elite Gunner (CR 4)</strong>
Medium humanoid, lawful evil
AC 17 (half‑plate), HP 85 (10d8+40)   Speed 30 ft.
STR 13 DEX 16 CON 18 INT 10 WIS 12 CHA 10
Saves Con +7, Dex +6   Skills Perception +3
Damage Res. poison   Languages Common
<strong>Multiattack.</strong> Two attacks (musket or bayonet).
<b>Bayonet Musket.</b> Ranged +7 (120/240 ft.) 13 (2d10+2) piercing; reload 1 turn.
<b>Bayonet.</b> Melee +5, 7 (1d8+3) slashing.
<b>Volley Fire (Recharge 5‑6).</b> If another gunner is within 10 ft., both attacks deal maximum damage this turn.
<b>Stand Your Ground (Reaction).</b> Adjacent ally gains half‑cover vs. one attack.</pre>`],

    "Berynian Scythes":[`
<pre><strong>Blackleaf Tribesman (CR 2)</strong>
Medium humanoid, neutral
AC 13 (leather), HP 45 (6d8+18)   Speed 30 ft.
STR 14 DEX 12 CON 14 INT 8 WIS 12 CHA 10
<b>Spear.</b> +4 (melee 5 ft.) 1d8+2 piercing.
<b>Shortbow.</b> +4 (80/320 ft.) 1d6+2 piercing.
<b>Forest Camouflage.</b> Advantage on Stealth checks in forest terrain.
<b>Tribal Tactics.</b> Advantage on melee attacks when an ally is adjacent to the target.</pre>`]
  };
  /*  ============  end CREATURES  ============  */
  </script>

  <!-- ——— functionality ——— -->
  <script>
  /* ============ helpers ============ */
  const slugify = s => s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
  const rollDice = (n,d) => Array.from({length:n},()=>Math.floor(Math.random()*d)+1)
                                  .reduce((a,b)=>a+b,0);
  function rollHpLine(html){
    /* sniff out HP 80 (10d8+36)  OR  HP 39   */
    const re=/HP\\s+(\\d+)(?:\\s*\\(\\s*(\\d+)d(\\d+)(\\s*[+‑‑−-]\\s*\\d+)?\\s*\\))?/i;
    const m=html.match(re);
    if(!m){return html.replace('HP','Max&nbsp;HP:&nbsp;_____');}
    if(m[2]){
      const roll = rollDice(+m[2],+m[3]) + (+m[4]?.replace(/\\s+/g,'')||0);
      return html.replace(re,`Max&nbsp;HP:&nbsp;${roll}`);
    }
    return html.replace(re,`Max&nbsp;HP:&nbsp;${m[1]}`);
  }

  /* ============ build definition pool & dropdown ============ */
  const defs = document.getElementById('definitions');
  const sel  = document.getElementById('creature-select');
  Object.entries(CREATURES).forEach(([faction,list])=>{
    list.forEach((block,i)=>{
      const name=(block.match(/<strong>(.*?)\\s*\\(CR/i)||[])[1]||`Creature ${i+1}`);
      const id  =slugify(`${faction}-${name}`);
      /* option */
      const opt=document.createElement('option');
      opt.value=id; opt.textContent=`${faction} — ${name}`;
      sel.appendChild(opt);
      /* hidden template */
      const div=document.createElement('div');
      div.id=id;div.className='creature';div.innerHTML=block;
      defs.appendChild(div);
    });
  });

  /* ============ card factory ============ */
  function cardFromHTML(html,doRoll=true){
    const wrap=document.createElement('div');
    wrap.className='pinned-entry';
    /* delete button */
    const x=document.createElement('button');
    x.className='remove-btn';x.innerHTML='×';
    x.onclick=()=>wrap.remove();
    wrap.appendChild(x);
    /* controls */
    wrap.insertAdjacentHTML('beforeend',`
      <div class="controls">
        <label>Init &nbsp;<input type="number" value=""></label>
        <label>HP &nbsp;<input type="number" value=""></label>
      </div>`);
    /* stats */
    const stats=document.createElement('div');
    stats.className='creature-data';
    stats.innerHTML=doRoll?rollHpLine(html):
       html.replace(/HP/i,'Max&nbsp;HP:&nbsp;_____');
    wrap.appendChild(stats);
    return wrap;
  }

  /* ============ button handlers ============ */
  document.getElementById('pin-button').onclick=()=>{
    const id=sel.value;if(!id)return;
    const src=document.getElementById(id);
    if(!src)return;
    const pre=src.querySelector('pre').outerHTML;
    document.getElementById('pinned-container').appendChild(cardFromHTML(pre));
  };

  document.getElementById('add-button').onclick=()=>{
    const blank=`<pre><strong>Name: _____</strong><br>Type & CR: _____<br>Max&nbsp;HP:&nbsp;_____</pre>`;
    document.getElementById('pinned-container').appendChild(cardFromHTML(blank,false));
  };

  document.getElementById('clear-button').onclick=()=>{
    document.getElementById('pinned-container').innerHTML='';
  };
  </script>
</body>
</html>
