<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Comedic Fantasy Commoner Generator</title>
  <link rel="icon" href="/resources/compass_favicon_32x32.png" type="image/png">
  <!-- ========== GOOGLE FONTS (some comedic flair) ========== -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@700&family=Open+Sans:wght@400;600&display=swap"
    rel="stylesheet"
  >

  <style>
    /* ============ BASIC STYLES ============ */
    /* This code is intentionally large to reflect the original scale. */

    body {
      margin: 0;
      /* Comedic background image, can be replaced with your own. */
      background: url('https://via.placeholder.com/1920x1080?text=Comedic+Fantasy') no-repeat center center fixed;
      background-size: cover;
      color: #F0EAD6; /* Light parchment color */
      font-family: 'Open Sans', sans-serif;
      text-align: center;
    }

    h1, h2, h3 {
      font-family: 'Amatic SC', cursive; /* Quirky heading font */
      margin-bottom: 0.5rem;
      color: #FFF4EC;
    }

    .fancy-divider {
      margin: 0.25rem 0 1rem;
      font-size: 1.2rem;
      text-align: center;
    }
    .fancy-divider::after {
      /* Extra comedic flair symbols */
      content: "♛ ♪ ☼";
      color: #FFC0CB;
      letter-spacing: 0.5rem;
    }

    .container {
      max-width: 1000px;
      margin: 2rem auto;
      background: rgba(0, 0, 0, 0.6);
      padding: 2rem;
      border-radius: 10px;
    }

    label {
      display: inline-block;
      width: 160px;
      margin-right: 8px;
      font-weight: bold;
      color: #FFFAF0;
    }

    select, input[type="text"], input[type="number"] {
      margin-bottom: 1rem;
      padding: 0.3rem;
      font-size: 1rem;
      background-color: #fffaf0; /* Slightly creamy for comedic flair */
      color: #333;
      border: 1px solid #ccc;
      font-family: 'Open Sans', sans-serif;
    }

    .button {
      background-color: #6B8E23; /* Olive color for comedic vibe */
      color: #fff;
      border: none;
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-size: 1rem;
      margin: 0.5rem 0;
      font-family: 'Open Sans', sans-serif;
      border-radius: 4px;
    }
    .button:hover {
      background-color: #556B2F;
    }

    .output {
      margin-top: 2rem;
      padding: 1rem;
      border: 1px solid #aaa;
      background-color: #fffaf0;
      color: #333;
      text-align: left;
    }

    .footer {
      margin-top: 3rem;
      font-size: 0.9rem;
      color: #ddd;
      font-family: 'Open Sans', sans-serif;
    }

    /* Hide the print button until a character is generated */
    #printButton {
      display: none;
    }

    /* ============= PRINT ONLY THE SHEET =============
       When printing, hide everything except #output. */
    @media print {
      body * {
        visibility: hidden !important;
      }
      #output,
      #output * {
        visibility: visible !important;
      }
      #output {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <h1>Comedic Fantasy Commoner Generator</h1>
  <div class="fancy-divider"></div>

  <!-- HOME BUTTON (optional link) -->
  <button class="button" onclick="window.location.href='https://example.com'">
    Home
  </button>

  <p>
    Generate a “level 0” or “level 0.5” comedic fantasy commoner.
    With robust, whimsical data sets to match the scale of the original.
  </p>

  <!-- ============ CHARACTER CREATION FORM ============ -->
  <div id="creation-form">

    <!-- Character Name -->
    <div>
      <label for="name-input">Name:</label>
      <input type="text" id="name-input" placeholder="Enter or randomise" />
      <button class="button" onclick="randomName()">Random</button>
    </div>

    <!-- Race Selection -->
    <div>
      <label for="race-select">Race:</label>
      <select id="race-select">
        <option value="">-- Choose --</option>
      </select>
      <button class="button" onclick="randomRace()">Random</button>
    </div>

    <!-- Background Selection -->
    <div>
      <label for="background-select">Background:</label>
      <select id="background-select">
        <option value="">-- Choose --</option>
      </select>
      <button class="button" onclick="randomBackground()">Random</button>
    </div>

    <!-- Ability Scores -->
    <div>
      <label>Ability Scores:</label><br/>
      <button class="button" onclick="rollAbilityScores()">Roll (4d6 drop lowest)</button>
      <button class="button" onclick="standardArray()">Standard Array (15,14,13,12,10,8)</button>
      <div id="abilities-display" style="margin-top:0.5rem;"></div>
    </div>

    <!-- Level Selection -->
    <div>
      <label for="level-select">Level:</label>
      <select id="level-select">
        <option value="0">0 (True Commoner)</option>
        <option value="0.5">0.5 (Slightly Skilled)</option>
      </select>
    </div>

    <!-- Generate Character & Full Random -->
    <div>
      <button class="button" onclick="generateCharacter()">Generate Commoner</button>
      <button class="button" onclick="fullRandom()">Full Random</button>
    </div>
  </div>

  <!-- ============ OUTPUT ============ -->
  <div id="output" class="output" style="display: none;">
    <h2 id="charName"></h2>
    <div class="fancy-divider"></div>

    <div id="charRace"></div>
    <div id="charBackground"></div>
    <div id="charAbilityScores"></div>
    <div id="charProficiencies"></div>
    <div id="charLanguages"></div>
    <div id="charEquipment"></div>

    <hr/>
    <div id="charTraits" style="margin-top:1rem;"></div>
  </div>

  <!-- PRINT BUTTON (appears once generated) -->
  <button class="button" id="printButton" onclick="window.print()">Print Commoner</button>

  <!-- ============ OGL NOTICE (FULL) ============ -->
  <div class="footer">
    <h3>Open Game License</h3>
    <p>
      This work includes material taken from the 5e System Reference Document (SRD),
      © 2016, Wizards of the Coast, Inc. and is covered by the 
      <strong>Open Game License, Version 1.0a</strong>.
      <br/><br/>
      <em>
      OPEN GAME LICENSE Version 1.0a<br>
      The following text is the property of Wizards of the Coast, Inc., 
      and is Copyright 2000 Wizards of the Coast, Inc ("Wizards").
      All Rights Reserved.<br>
      1. Definitions: (a)"Contributors" means the copyright and/or 
      trademark owners who have contributed Open Game Content...
      <a href="https://media.wizards.com/2016/downloads/DND/SRD-OGL_V5.1.pdf" target="_blank">Read the full license</a>.
      </em>
    </p>
  </div>
</div>

<script>
/* ==================================================
   ========== LARGE NAME SYSTEM (COMEDIC) ===========
   ================================================== */

/* We replicate the logic from the original code. 
   Below we define large comedic arrays. */

let FIRST_NAMES = [];
let LAST_NAMES = [];

const RAW_NAMES = [
  // A huge comedic list of ~200 names 
  "Gigglenut Wobblesworth",
  "Puffersnook Winklebottom",
  "Daffodil Spindlethorpe",
  "Ziggity Zogworthy",
  "Flummox Bumblethorn",
  "Sprinkle Tinkleroot",
  "Muddlefoot Jazzyfrill",
  "Twinkleface Butterhop",
  "Snickle Loonhopper",
  "Bibblesnuff Merrymoose",
  "Fiddlewig Zonk",
  "Doodle VonHiccup",
  "Razzmatazz Binglebutt",
  "Cricket Fuffernick",
  "Muffin Twirljay",
  "Boddington Snootlebop",
  "Wigglesnort Frimble",
  "Zanzibar Jigglesauce",
  "Hiccuphorn Frangleclaw",
  "Cookie Tumbletwirl",
  "Niffles Quickenpop",
  "Quibble Dazzlemuff",
  "Pippin Singletweed",
  "Brickle Bumblefizz",
  "Rumpletie Glittersnap",
  "Kajigger Diddlepump",
  "Guffin Mewlwhiff",
  "Zugzug Blortersnook",
  "Blinkus Poppinrod",
  "Fibble Buttersqueeze",
  "Jinkle Spriggleton",
  "Tugger Miffleslack",
  "Hootens Rasplenip",
  "Zonko Fiddlenock",
  "Crungly Tinselwhip",
  "Napper Jinglemirch",
  "Ribblestan Clodhopper",
  "Shimmerstem Piffleflip",
  "Tumblefoot Quizzle",
  "Bongo Dazzlecrumb",
  "Miggle Stumblefuss",
  "Wimble Snollygoster",
  "Biffle Hoopendazz",
  "Klipple Jazzybuzz",
  "Flipper Derpledew",
  "Zinny Muckwench",
  "Huffle Drizzleflap",
  "Clonker Mopplegrain",
  "Skoochy Buffernugget",
  "Gribble Dandywrench",
  "Mimzy Floofengill",
  "Snorkle Gruddlewink",
  "Umbra Twirlymew",
  "Vipper Clankerspike",
  "Wumble Glovernick",
  "Doodlehonk Fizzens",
  "Faffy Glimmercog",
  "Grunky Bumbleflap",
  "Honcho Drabbledoke",
  "Igloo Wisherjack",
  "Jinxy Natterflake",
  "Krunk Rhapsodypunch",
  "Lumple Tinderdock",
  "Monka Twiddlebeak",
  "Niffy Wappenslack",
  "Obble Bobbleback",
  "Poffin Tutterbin",
  "Quarky Zesterdimp",
  "Rigmor Glittertoes",
  "Scumble Tatterblink",
  "Twango Jibblenut",
  "Urple Flickersnap",
  "Vimby Yapperdink",
  "Wimblesnot Glimmerford",
  "Yippee Niffleknot",
  "Zipper Piffyjack",
  "Bobbin Hootish",
  "Snoot Fiddleknock",
  "Frootie Mingerbell",
  "Sparkle Giddyfuss",
  "Flinxy Grombag",
  "Zingle Snurry",
  "Hubblefuss Clamperton",
  "Dibbledap Twinklebutt",
  "Fuzzle Pumpernick",
  "Grixby Dazzleband",
  "Nibbles Tinkertuff",
  "Jibbles Donkingshoot",
  "Crimble Foofendirk",
  "Slurpz Wigglepounce",
  "Toggel Minkumsnort",
  "Tiffy Bunsprinkle",
  "Wrinkle Stubblenock",
  "Xiggy Crumpchaff",
  "Yaffle Fiddlefuss",
  "Zigzag Bunkersniff",
  "Tuffet Glimmerplop",
  "Knuckles Bafflebang",
  "Bibble Rinksnap",
  "Snippydook Foggerwink",
  "Quinny Fudgefry",
  "Derry Mifflestuff",
  "Epoxy Gloomdrift",
  "Flinky Jacksprout",
  "Grenby Butterchime",
  "Hunky Drimmlestone",
  "Indigo Raspbuncle",
  "Joggles Mezzoplex",
  "Kumquat Frimblestub",
  "Ludo Pinklespore",
  "Mogey Wifflecake",
  "Noonoo Zigbolt",
  "Orble Wallynock",
  "Popple Blizzledock",
  "Ribbles Grinklemush",
  "Snaggy Quoppleding",
  "Toodles Fringlestomp",
  "Upsy Scruffler",
  "Velvety Nuthatch",
  "Wambo Bucklespit",
  "Zorflap Tiddlewink",
  "Fibble Gloopensnort",
  "Huggle Trixiedum",
  "Puffle Gloobender",
  "Sizzle Yippinstomp",
  "Quee Quoofendip",
  "Nurfle Stinkyswamp",
  "Stumple Briningford",
  "Baggy Drunkenpunch",
  "Dinky Frabblesmack",
  "Easel Doodlebrink",
  "Flapper Sprangleton",
  "Gribbin Tiltermilk",
  "Hipsy Danderflip",
  "Jippy Mozzleton",
  "Krumple Daffysnort",
  "Leezle Quompersnik",
  "Mitzle Quirkensock",
  "Nordy Flickerbeak",
  "Ooloo Shimmerpunch",
  "Pipsy Turntangle",
  "Rasp Clobbertail",
  "Snazz Slinklering",
  "Tinka Dunderfizz",
  "Udoo Haggletash",
  "Vinty Jifferplank",
  "Wombo Narglesnuff",
  "Xexy Miffleflute",
  "Yawble Grumbleton",
  "Zibbly Gackledunk",
  "Armpit Gunksprout",
  "Beeble Dorkindale",
  "Chumple Gigglybunt",
  "Doodle Poppelfritz",
  "Eggsy Wackledurf",
  "Florky Janglemoor",
  "Gammer Stumblechuck",
  "Huffly Zirglepop",
  "Igby Futtermuck",
  "Jibber Splatterfoot",
  "Kippy Minklestop",
  "Lurk Spudderchoke",
  "Mumfy Dazzlechirp",
  "Nimly Drampersnug",
  "Oddy Winklebib",
  "Pudgy Kinkersloth",
  "Quonty Laughershot",
  "Rippit Bumblefoot",
  "Snorf Harrumphfrill",
  "Tulla Gilgenwhoof",
  "Ursul Zobberslack",
  "Virple Noggydew",
  "Wooper Nurdlesnipe",
  "Xed Speckleband",
  "Yenby Shudderswitch",
  "Zonther Giggymug"
];

/* We'll parse RAW_NAMES into separate FIRST_NAMES and LAST_NAMES. */
function parseFullName(fullName) {
  const trimmed = fullName.trim();
  if (!trimmed) return null;
  const parts = trimmed.split(/\s+/);
  if (parts.length === 1) {
    return { first: parts[0], last: "" };
  } else {
    const first = parts[0];
    const last = parts[parts.length - 1];
    return { first, last };
  }
}

RAW_NAMES.forEach((nm) => {
  const parsed = parseFullName(nm);
  if (parsed) {
    FIRST_NAMES.push(parsed.first);
    LAST_NAMES.push(parsed.last);
  }
});

/* ==================================================
   ========== SRD-BASED RACES (COMEDIC) =============
   ================================================== */
const RACES = [
  {
    name: "Gigglen Goblin",
    abilityScoreBonuses: { DEX: 2, CHA: -1 },
    speed: 30,
    features: [
      "Nimble Escape (disengage/hide as bonus action)",
      "Comedic Cackle (once/day confuses enemies)"
    ],
    languages: ["Common", "Goblinish"]
  },
  {
    name: "Dazzle Elf",
    abilityScoreBonuses: { DEX: 2 },
    speed: 30,
    features: [
      "Darkvision (60 ft)",
      "Sparkle Senses (+2 to Perception checks in sunlight)",
      "Fey Glitter (once/day produce glitzy illusions)"
    ],
    languages: ["Common", "Elvish"]
  },
  {
    name: "Snortling Dwarf",
    abilityScoreBonuses: { CON: 2 },
    speed: 25,
    features: [
      "Darkvision (60 ft)",
      "Snorty Resilience (adv. on poison saves)",
      "Stone Guffaw (once/day shake ground with laughter)"
    ],
    languages: ["Common", "Dwarvish"]
  },
  {
    name: "Mirthling Halfling",
    abilityScoreBonuses: { DEX: 2 },
    speed: 25,
    features: [
      "Lucky (reroll 1s on attacks/ability checks/saves)",
      "Brave (adv. on fear saves)",
      "Mirthful Spirit"
    ],
    languages: ["Common", "Halflingish"]
  },
  {
    name: "Bogsnort Orc",
    abilityScoreBonuses: { STR: 2, INT: -1 },
    speed: 30,
    features: [
      "Relentless Endurance (once/day drop to 1 HP instead of 0)",
      "Swampy Snort (resistance to comedic stench illusions)"
    ],
    languages: ["Common", "Orcish"]
  },
  {
    name: "Spriggan Gnome",
    abilityScoreBonuses: { INT: 2 },
    speed: 25,
    features: [
      "Darkvision (60 ft)",
      "Gnome Cunning (adv. on mental saves vs. illusions)",
      "Tinker Trickster"
    ],
    languages: ["Common", "Gnomish"]
  },
  {
    name: "Half-Elfish Nudger",
    abilityScoreBonuses: { CHA: 2, PLUS_TWO_OTHERS: 1 },
    speed: 30,
    features: [
      "Nudging Charm (once/day subtly push an NPC reaction +1 step)",
      "Darkvision (60 ft)",
      "Elf-Human Heritage"
    ],
    languages: ["Common", "Elvish", "One Extra Language"]
  },
  {
    name: "Punny Tiefling",
    abilityScoreBonuses: { CHA: 2, INT: 1 },
    speed: 30,
    features: [
      "Darkvision (60 ft)",
      "Hellish Wittyness (once/day use pun to distract foes)",
      "Infernal Legacy"
    ],
    languages: ["Common", "Infernalish"]
  },
  {
    name: "Dragoonborn Chuckler",
    abilityScoreBonuses: { STR: 2, CHA: 1 },
    speed: 30,
    features: [
      "Draconic Chuckle (once/day 15 ft cone laughter breath, deals Psychic damage)",
      "Resistance to Psychic if from comedic breath",
      "Scaly Hide"
    ],
    languages: ["Common", "Dragonsnort"]
  },
  {
    name: "Fizziwig Human",
    abilityScoreBonuses: {
      STR: 1, DEX: 1, CON: 1, INT: 1, WIS: 1, CHA: 1
    },
    speed: 30,
    features: ["Versatile", "Adaptive Humor"],
    languages: ["Common", "One Extra Language of your choice"]
  }
];

/* ==================================================
   ========== BACKGROUNDS (COMEDIC) (Large) =========
   ================================================== */
const BACKGROUNDS = [
  {
    name: "Acolyte of Slapstick",
    skillProficiencies: ["Insight", "Performance"],
    equipment: [
      "Holy symbol (shaped like a clown nose)",
      "Rubber chicken",
      "5 squeaky hammers",
      "Vestments with silly prints",
      "Set of comedic clothes",
      "Belt pouch containing 15 cp"
    ],
    feature: "Shelter of the Goofs",
    featureDesc: "You can find comedic lodging in temples of slapstick. They feed you pie in the face daily.",
    nicknames: ["Slappy", "Rubberholic", "Squeaker"]
  },
  {
    name: "Criminal/Spy (who loves Pranks)",
    skillProficiencies: ["Deception", "Stealth"],
    equipment: [
      "Crowbar disguised as a giant banana",
      "Dark comedic clothes including clown hood",
      "Belt pouch containing 15 cp"
    ],
    feature: "Prankster Contact",
    featureDesc: "You have a reliable, silly contact in the underbelly who smuggles whoopee cushions.",
    nicknames: ["Sneakster", "Banana Thief", "Whoopee"]
  },
  {
    name: "Folk Hero (Town Laughingstock)",
    skillProficiencies: ["Animal Handling", "Survival"],
    equipment: [
      "Set of comedic artisan's tools (like a donkey brush)",
      "Floppy shovel",
      "Iron pot with cartoon hole",
      "Set of comedic clothes",
      "Belt pouch containing 10 cp"
    ],
    feature: "Rustic Hospitality (But Everyone Laughs)",
    featureDesc: "Commoners love your silly ways, so they hide you and also giggle at you.",
    nicknames: ["Hayseed", "Giggle Farmer", "Pitchfork Chuckle"]
  },
  {
    name: "Guild Artisan (Candy Crafter)",
    skillProficiencies: ["Insight", "Persuasion"],
    equipment: [
      "Set of candy-making tools",
      "Letter of introduction from the Candy Guild",
      "Set of candy-patterned clothes",
      "Belt pouch containing 15 gp"
    ],
    feature: "Candy Membership",
    featureDesc: "Guild members might trade sweets for your comedic candy innovations.",
    nicknames: ["Sugarplum", "Toffee Maker", "Candyman"]
  },
  {
    name: "Hermit of the Silly Swamp",
    skillProficiencies: ["Medicine", "Religion"],
    equipment: [
      "Scroll case stuffed with comedic swamp observations",
      "Rubber snake",
      "Set of comedic rags",
      "Herbalism kit soaked in swamp water",
      "5 cp"
    ],
    feature: "Swampy Discovery",
    featureDesc: "You found comedic truths in the bog that amuse or horrify others.",
    nicknames: ["Frogwhisper", "Soggy Sage", "Mud Prophet"]
  },
  {
    name: "Noble (Heir to Laughter Kingdom)",
    skillProficiencies: ["History", "Persuasion"],
    equipment: [
      "Set of flamboyant clothes",
      "Signet ring shaped like a smiley face",
      "Scroll of comedic pedigree",
      "Purse containing 25 gp"
    ],
    feature: "Position of Comedy",
    featureDesc: "Commoners see your comedic aristocracy with awe. Nobles see you as an odd equal.",
    nicknames: ["Lord Chuckles", "Duchess Giggle", "Count Guffaw"]
  },
  {
    name: "Outlander (Wacky Wanderer)",
    skillProficiencies: ["Athletics", "Survival"],
    equipment: [
      "Staff carved with silly faces",
      "Hunting trap that squeaks",
      "Trophy from an exotic comedic creature you pranked",
      "Set of comedic traveler’s clothes",
      "Belt pouch containing 10 gp"
    ],
    feature: "Wanderer (with comedic memory)",
    featureDesc: "You always recall comedic side roads, hidden jokes, and can find comedic sustenance.",
    nicknames: ["Joker Scout", "Mirth Rover", "Punchline Explorer"]
  },
  {
    name: "Sage (Arcane Slapstick Scholar)",
    skillProficiencies: ["Arcana", "History"],
    equipment: [
      "Bottle of invisible ink (or so you claim)",
      "Quill shaped like a goose’s head",
      "Tiny comedic knife",
      "A letter from a clown wizard with a baffling riddle",
      "Set of comedic robes",
      "Belt pouch containing 10 gp"
    ],
    feature: "Comic Researcher",
    featureDesc: "You know where to find comedic lore in the grand libraries of guffaws.",
    nicknames: ["Quillfool", "Owlclown", "Stacks-o-laughs"]
  },
  {
    name: "Sailor (on the Jolly Sea)",
    skillProficiencies: ["Athletics", "Perception"],
    equipment: [
      "Belaying pin shaped like a fish",
      "50 feet of silly rope with comedic patterns",
      "Lucky charm shaped like a rubber duck",
      "Set of comedic sailor clothes",
      "Belt pouch containing 10 gp"
    ],
    feature: "Ship’s Passage (But Everyone Laughs)",
    featureDesc: "You can get passage, but your comedic rep means the crew may play pranks on you.",
    nicknames: ["Anchors Aweird", "Salty Joker", "Deck Chuckler"]
  },
  {
    name: "Soldier (of Clown Wars)",
    skillProficiencies: ["Athletics", "Intimidation"],
    equipment: [
      "Insignia of comedic rank (like a clown badge)",
      "Trophy from a clown war foe (a big red nose?)",
      "Set of comedic dice or clownish deck of cards",
      "Set of comedic battle clothes",
      "Belt pouch containing 10 gp"
    ],
    feature: "Military Rank (Clown Division)",
    featureDesc: "Other comedic soldiers respect your authority if they outrank you in silliness.",
    nicknames: ["Major Banana Peel", "Captain Confetti", "Sarge Seltzer"]
  },
  // Large comedic expansions:
  {
    name: "Urchin (Balloon Maker)",
    skillProficiencies: ["Sleight of Hand", "Stealth"],
    equipment: [
      "Small squeaky knife",
      "Map of comedic carnival city you grew up in",
      "Pet balloon animal (deflates daily)",
      "Token from your silly parents",
      "Set of comedic clothes",
      "Belt pouch containing 10 cp"
    ],
    feature: "City Secrets (Carnival Tunnels)",
    featureDesc: "You know hidden carnival tracks that double travel speed if you amuse watchers.",
    nicknames: ["Balloon Rat", "Clown Alley Kid", "Pop Stray"]
  },
  {
    name: "Tanner (Leather Gag Maker)",
    skillProficiencies: ["Survival", "Nature"],
    languages: [],
    equipment: [
      "A comedic tanning kit",
      "Sturdy apron with funny slogans",
      "A dyed hide with comedic face",
      "Comedic clothes",
      "Belt pouch containing 5 cp"
    ],
    feature: "Leatherwise (Silly Edition)",
    featureDesc: "You can identify comedic potential in hides, selling them to jesters easily.",
    nicknames: ["Hide-n-Giggle", "Skins Fool", "Tannic Chuckle"]
  },
  {
    name: "Alchemist (Fizzy Drinker)",
    skillProficiencies: ["Arcana", "Medicine"],
    languages: [],
    equipment: [
      "Alchemist’s kit with comedic flasks",
      "Weathered notebook full of fizz formulas",
      "Set of stained comedic clothes",
      "Belt pouch containing 10 cp"
    ],
    feature: "Experimental Fizz",
    featureDesc: "Local comedic brewers see your potions as potential comedic gold.",
    nicknames: ["Fizzle", "BrewJoke", "BubbleDoc"]
  },
  {
    name: "Miner (Sparkly Gem Hunter)",
    skillProficiencies: ["Athletics", "Perception"],
    languages: [],
    equipment: [
      "A comedic pickaxe (sparkly handle)",
      "A lantern shaped like a silly face",
      "Small gem sample with comedic swirl",
      "Sturdy comedic boots",
      "Belt pouch containing 10 cp"
    ],
    feature: "Tunnel Instinct (Silly)",
    featureDesc: "You can sense comedic collapses or illusions in mines; dwarves trust your jokes.",
    nicknames: ["Pick Chuckle", "Orepun", "Dusty Laugh"]
  },
  {
    name: "Beast Tamer (Silly Squeak)",
    skillProficiencies: ["Animal Handling", "Nature"],
    languages: [],
    equipment: [
      "A length of comedic rope",
      "A carved token of your favorite silly beast",
      "Dried comedic jerky treats",
      "Set of comedic outdoor attire",
      "Belt pouch containing 5 cp"
    ],
    feature: "Animal Rapport (Squeak Edition)",
    featureDesc: "Domestic beasts find you comedic, possibly calming them with squeaks.",
    nicknames: ["Buck Cluck", "Wrangler Chuckles", "Critter Giggler"]
  },
  // ... (You can keep going to 40 or 50 comedic backgrounds if you want the code extremely large)
  {
    name: "Chandler (Luminescent Candle Maker)",
    skillProficiencies: ["Persuasion", "Investigation"],
    languages: [],
    equipment: [
      "Block of color-changing wax",
      "Candle mould shaped like a clown hat",
      "Ledger of comedic sales",
      "Set of comedic neat clothes",
      "Belt pouch containing 7 cp"
    ],
    feature: "Keeper of Light (Silly Candles)",
    featureDesc: "Locals rely on your color-shifting comedic candles for festivals.",
    nicknames: ["Candle Giggles", "Wax Joker", "Wick Chuckle"]
  },
  {
    name: "Cooper (Barrel of Laughs)",
    skillProficiencies: ["History", "Sleight of Hand"],
    languages: [],
    equipment: [
      "Cooper’s hammer (painted bright pink)",
      "Ring of comedic iron hoops",
      "Small barrel you made (painted clown face)",
      "Set of comedic working clothes",
      "Belt pouch containing 10 cp"
    ],
    feature: "Well-Bound Containers (Silly Edition)",
    featureDesc: "Merchants love your comedic barrels for storing clown supplies, if not dignity.",
    nicknames: ["Barrel Guffaw", "Hoops Chuckle", "Ring Ding"]
  },
  {
    name: "Cartwright (Silly Waggons)",
    skillProficiencies: ["Carpenter’s Tools", "History"],
    languages: [],
    equipment: [
      "Small comedic woodworking toolkit",
      "Mini cart model with comedic paint",
      "Set of comedic sturdy clothes",
      "Belt pouch containing 10 cp"
    ],
    feature: "Roadwise (Clown Edition)",
    featureDesc: "You can fix comedic squeaks in waggons & advise on comedic routes.",
    nicknames: ["Wheels Chuckle", "Axle Giggles", "Spokes HaHa"]
  },
  {
    name: "Scribe (Jokebook Keeper)",
    skillProficiencies: ["History", "Investigation"],
    languages: ["One comedic language"], 
    equipment: [
      "Quill shaped like a comedic feather",
      "Small jar of multicolor comedic ink",
      "Stack of silly parchment",
      "A personal log of comedic scribbles",
      "Set of comedic neat clothes",
      "Belt pouch containing 5 cp"
    ],
    feature: "Comedic Academic Access",
    featureDesc: "Libraries let you copy comedic jokes if you promise to amuse them.",
    nicknames: ["Ink Guffaw", "Scroll Giggles", "Quill Chuckle"]
  },
  {
    name: "Glassblower (Prank Glass Art)",
    skillProficiencies: ["Arcana", "Perception"],
    languages: [],
    equipment: [
      "Glassblowing pipe shaped like a duck",
      "A carefully wrapped comedic glass statue",
      "Comedic goggles with painted eyebrows",
      "Set of comedic clothes",
      "Belt pouch containing 5 cp"
    ],
    feature: "Fragile Eye (Silly Edition)",
    featureDesc: "You spot comedic cracks or illusions in glass or illusions disguised as glass.",
    nicknames: ["Fragile Gag", "Pane Chuckles", "Torch Laugh"]
  },
  {
    name: "Jeweller (Clown Gems)",
    skillProficiencies: ["Insight", "Sleight of Hand"],
    languages: [],
    equipment: [
      "Loupe shaped like a monocle with googly eyes",
      "Pouch of comedic low-value gem shards",
      "Set of comedic but modest clothes",
      "Belt pouch containing 15 cp"
    ],
    feature: "Clown Gem Appraisal",
    featureDesc: "You swiftly gauge comedic gem illusions & approximate value in comedic markets.",
    nicknames: ["Shine Chuckles", "Facet Giggle", "Pearl Guffaw"]
  },
  {
    name: "Shipwright (Silly Ship Repairs)",
    skillProficiencies: ["Athletics", "Carpenter’s Tools"],
    languages: [],
    equipment: [
      "Small mallet (rainbow handle)",
      "Driftwood piece with comedic etch",
      "Set of comedic rugged clothes",
      "Belt pouch containing 10 cp"
    ],
    feature: "Maritime Comedy Specialist",
    featureDesc: "Ports respect your comedic approach to ship repairs. You can find comedic passage.",
    nicknames: ["Timbers Giggles", "Hull Laugh", "Dock Chuckle"]
  },
  {
    name: "Bowyer/Fletcher (Clown Arrows)",
    skillProficiencies: ["Nature", "Perception"],
    languages: [],
    equipment: [
      "Bundle of squeaking arrow shafts",
      "Small bowyer’s comedic toolkit",
      "Set of comedic workable clothes",
      "Belt pouch containing 5 cp"
    ],
    feature: "Arrow Prankster",
    featureDesc: "You craft comedic arrows from nature & can assess comedic bows at a glance.",
    nicknames: ["Arrow Chuckle", "Fletch Laugh", "Bowstring Guffaw"]
  },
  {
    name: "Cobbler (Funny Boots)",
    skillProficiencies: ["Sleight of Hand", "Insight"],
    languages: [],
    equipment: [
      "Cobbler’s comedic kit (awl, hammer, clown patches)",
      "A giant comedic boot you crafted",
      "Set of comedic clothes",
      "Belt pouch containing 8 cp"
    ],
    feature: "Sure-Footed (Funny Steps)",
    featureDesc: "Your comedic boots amuse and you can track prints that look comedic in style.",
    nicknames: ["Boot Chuckle", "Soles Giggle", "Stitch Laugh"]
  },
  {
    name: "Farmer (Cackling Crops)",
    skillProficiencies: ["Animal Handling", "Nature"],
    languages: [],
    equipment: [
      "Sickle shaped like a grin",
      "A small pouch of trick seeds",
      "A wide-brimmed comedic straw hat",
      "A set of comedic sturdy clothes",
      "Belt pouch containing 5 cp"
    ],
    feature: "Local Harvest Laughter",
    featureDesc: "You know comedic ways to tend crops. Locals love your silly produce.",
    nicknames: ["Seed Chuckle", "Haystack Laugh", "Scythe Giggles"]
  },
  {
    name: "Fisher (Fishy Comedian)",
    skillProficiencies: ["Survival", "Perception"],
    languages: [],
    equipment: [
      "A comedic fishing rod with squeak handle",
      "A small tackle box of rubber worms",
      "A net that whistles",
      "A set of comedic waterproof boots",
      "Belt pouch containing 5 cp"
    ],
    feature: "Waterside Comedy",
    featureDesc: "Fisherfolk enjoy your comedic fish tales & help you gather silly fish rations.",
    nicknames: ["Fin Chuckle", "Hook Giggles", "Minnow Laugh"]
  }
];

/* ==================================================
   ========== PERSONALITY TRAITS (Large comedic) =====
   ================================================== */
const PERSONALITY_TRAITS = [
  "I laugh spontaneously even without a joke.",
  "I juggle random objects whenever I’m bored.",
  "I consider big hats the peak of civilisation.",
  "I respond to conflict with clown horns instead of words.",
  "I name all insects I see, believing they’re my minions.",
  "I keep a diary of every pun I hear, rating them harshly.",
  "I talk to my reflection as if it’s a twin sibling.",
  "I can’t sleep unless I recite at least ten knock-knock jokes.",
  "I brew questionable potions from random mushrooms, just to see what happens.",
  "I always smell freshly-baked cookies, even when none exist.",
  /* We'll go up to ~100 comedic traits to match the scale */
  "I have a secret handshake I attempt with everyone, though no one else knows it.",
  "I prefer to climb through windows rather than use doors.",
  "I offer sock puppets to strangers as a conversation starter.",
  "I answer rhetorical questions earnestly, often confusing people.",
  "I practice comedic shadow puppets on cave walls.",
  "I sniff books to gauge their comedic value.",
  "I firmly believe spoons are superior to forks for all tasks.",
  "I constantly hum a tune that changes key unpredictably.",
  "I suspect geese are spies from another realm.",
  "I try to guess people’s favourite fruit upon first meeting them.",
  "I argue with the sun for setting too early.",
  "I squeak like a duck if someone touches my shoulder unexpectedly.",
  "I dream of hosting a carnival on the moon.",
  "I collect feathers, hoping to build wings one day.",
  "I greet enemies with tickles before attacking.",
  "I narrate my life out loud as if in a comedic play.",
  "I refuse to wear matching shoes, calling it “fashion rebellion.”",
  "I believe wearing three hats at once doubles my intelligence.",
  "I blow bubbles from a pipe instead of smoking it.",
  "I measure all distances in clown noses instead of feet.",
  "I cannot resist patting every dog I see and telling it secrets.",
  "I claim I can speak to cheese, though it’s never confirmed.",
  "I suspect all mirrors lead to an alternate clown dimension.",
  "I yodel at dawn to greet the new day, baffling neighbours.",
  "I hoard rubber ducks, insisting they predict the weather.",
  "I only dance the polka in serious ceremonies.",
  "I treat maps as suggestions, preferring to wander aimlessly.",
  "I try to solve every riddle with a limerick.",
  "I take notes on every pun I hear, grading them A-F.",
  "I keep a hidden maraca for urgent comedic breaks.",
  "I believe cacti are guardian spirits of the desert.",
  "I chat with inanimate objects, seeking their wise counsel.",
  "I see conspiracies in idle chatter, weaving comedic theories.",
  "I randomly change my accent mid-sentence to keep people guessing.",
  "I quote fake philosophers at length, attributing it to “the Eldest Clown.”",
  "I name each toe individually, boasting about their personalities.",
  "I attempt to ride any large animal as a noble steed, even goats or giant chickens.",
  "I snort when I laugh, but pretend it’s a battle cry.",
  "I fear hummingbirds, believing they hold cosmic secrets.",
  "I claim to have invented the concept of “high fives.”",
  "I dress up mannequins in comedic outfits for personal company.",
  "I keep a diary of dream jokes and read them to strangers.",
  "I cannot read a menu without creating comedic alliterations of each dish.",
  "I beep like a car horn whenever people block my path.",
  "I store confetti in my pockets for random celebrations.",
  "I greet any mention of danger with a comedic challenge, like “Aha! Let’s juggle knives!”",
  "I prefer sleeping in closets because beds are “too mainstream.”",
  "I suspect reading glasses hold mind-control powers, so I wear four pairs at once.",
  "I brew coffee in teapots and tea in coffee pots, just to be contrarian.",
  "I greet authority figures with a handshake and a whoopee cushion.",
  "I write comedic disclaimers on every item I own, just in case.",
  "I chew gum to the rhythm of the environment, like a comedic interpretive dance.",
  "I attempt to camouflage myself behind lampposts, exclaiming “You can’t see me!”",
  "I brag about invisible tattoos that illustrate my heroic illusions.",
  "I speak in riddles, but get them wrong halfway through.",
  "I have an imaginary friend named Sir Bubbles, who I blame for my mistakes.",
  "I use random words like “spoonfish” or “plonk” as filler in normal conversation.",
  "I always knock on a table thrice for luck, even mid-battle.",
  "I juggle spoons or pebbles whenever anxious, ignoring social cues.",
  "I suspect fish can read my thoughts, so I wear a tinfoil hat near lakes.",
  "I stage comedic sword fights with broomsticks in empty rooms for practice.",
  "I believe sneezes are actually comedic ghosts escaping the body.",
  "I break into show tunes if anyone says the word “banana.”",
  "I bet on snail races that I host in secret alleyways.",
  "I claim to be an expert in “flabbergastology,” a made-up discipline.",
  "I keep a tiny silver bell, ringing it whenever I have a comedic idea.",
  "I sleepwalk while reciting knock-knock jokes.",
  "I cannot hold serious conversations without winking every few seconds.",
  "I interpret all warnings as invitations for comedic pranks.",
  "I suspect walnuts are enchanted eggs from a nut wizard realm.",
  "I compare every new acquaintance to a type of pastry, explaining in detail.",
  "I firmly believe time flows backward on holidays, so I dress in reverse.",
  "I try to high-five any statue or carving that looks vaguely humanoid.",
  "I talk like a pirate whenever I’m confused, hoping it clarifies things.",
  "I greet the rising moon with a love poem each night, praising its comedic shape.",
  "I store random birds’ feathers in a scrap book titled “Featherpedia.”",
  "I keep a comedic scoreboard of my day’s puns on my belt.",
  "I cannot refrain from interpretive dance when I hear a lute playing.",
  "I hope to open a comedic donkey ranch that also sells cupcakes.",
  "I wear clown shoes under normal boots, just in case I need comedic footsteps.",
  "I suspect ravens are actually stand-up comedians in disguise.",
  "I claim my hair is cursed to change color whenever I’m bored.",
  "I taste-test potions with a comedic straw, claiming it’s safer that way.",
  "I adore fireworks but set them off at random times for comedic shock.",
  "I casually mention that I’m older than I look because I once time-traveled in a trunk."
];

/* ==================================================
   ========== PAGE INITIALISATION ===================
   ================================================== */

window.addEventListener("DOMContentLoaded", () => {
  populateSelect("race-select", RACES.map(r => r.name));
  populateSelect("background-select", BACKGROUNDS.map(b => b.name));
});

function populateSelect(selectId, optionsArray) {
  const selectElem = document.getElementById(selectId);
  optionsArray.forEach(opt => {
    const optionEl = document.createElement("option");
    optionEl.value = opt;
    optionEl.innerText = opt;
    selectElem.appendChild(optionEl);
  });
}

/* ==================================================
   ========== RANDOMISATION + HELPER FUNCTIONS =======
   ================================================== */

function pickRandom(array) {
  return array[Math.floor(Math.random() * array.length)];
}

function pickMultipleDistinct(array, count) {
  // same logic as the original
  const copy = [...array];
  const result = [];
  if (count > copy.length) count = copy.length;
  for (let i = 0; i < count; i++) {
    const index = Math.floor(Math.random() * copy.length);
    result.push(copy[index]);
    copy.splice(index, 1);
  }
  return result;
}

function roll4d6DropLowest() {
  let scores = [];
  for (let i = 0; i < 6; i++) {
    let rolls = [0,0,0,0].map(() => Math.floor(Math.random() * 6) + 1);
    rolls.sort((a,b) => a - b);
    rolls.shift(); // drop the lowest
    const sum = rolls.reduce((acc, val) => acc + val, 0);
    scores.push(sum);
  }
  return scores;
}

function getStandardArray() {
  return [15,14,13,12,10,8];
}

function abilityMod(score) {
  return Math.floor((score - 10) / 2);
}

/* ==================================================
   ========== NAME HANDLERS =========================
   ================================================== */

function randomName() {
  if (FIRST_NAMES.length === 0 || LAST_NAMES.length === 0) {
    document.getElementById("name-input").value = "Nameless Soul";
    return;
  }
  const first = pickRandom(FIRST_NAMES);
  const last = pickRandom(LAST_NAMES);
  document.getElementById("name-input").value = first + " " + last;
}

/* ==================================================
   ========== RACE & BACKGROUND RANDOMISERS =========
   ================================================== */

function randomRace() {
  const randomPick = pickRandom(RACES).name;
  document.getElementById("race-select").value = randomPick;
}

function randomBackground() {
  const randomPick = pickRandom(BACKGROUNDS).name;
  document.getElementById("background-select").value = randomPick;
}

/* ==================================================
   ========== ABILITY SCORE HANDLERS ================
   ================================================== */

let currentScores = [10,10,10,10,10,10]; // default

function rollAbilityScores() {
  currentScores = roll4d6DropLowest();
  displayScores();
}

function standardArray() {
  currentScores = getStandardArray();
  displayScores();
}

function displayScores() {
  const container = document.getElementById("abilities-display");
  const labels = ["STR", "DEX", "CON", "INT", "WIS", "CHA"];
  let html = "";
  currentScores.forEach((sc, i) => {
    const mod = abilityMod(sc);
    const modPrefix = mod >= 0 ? "+" : "";
    html += `${labels[i]}: <strong>${sc}</strong> (${modPrefix}${mod})<br/>`;
  });
  container.innerHTML = html;
}

/* ==================================================
   ========== CHARACTER GENERATION ==================
   ================================================== */

function parseUserName(fullInput) {
  const parts = fullInput.trim().split(/\s+/);
  let firstName = "";
  let lastName = "";
  if (parts.length === 1) {
    firstName = parts[0];
  } else if (parts.length > 1) {
    firstName = parts[0];
    lastName = parts[parts.length - 1];
  }
  return { firstName, lastName };
}

function generateCharacter() {
  // 1. Name: parse user’s typed input
  const rawName = document.getElementById("name-input").value.trim() || "Unnamed Goon";
  let { firstName, lastName } = parseUserName(rawName);

  // 2. Race & background data
  const raceSelected = document.getElementById("race-select").value;
  const raceData = RACES.find(r => r.name === raceSelected);
  if (!raceData) {
    // If user never selected a race or used Full Random, randomRace() is called in fullRandom. 
    // But if they manually pressed "Generate Commoner" without picking, we can prompt:
    alert("Please select a race (or use Full Random).");
    return;
  }

  const bgSelected = document.getElementById("background-select").value;
  const bgData = BACKGROUNDS.find(b => b.name === bgSelected);
  if (!bgData) {
    alert("Please select a background (or use Full Random).");
    return;
  }

  // 3. Possibly add a nickname (1/5 chance)
  if (bgData.nicknames && bgData.nicknames.length > 0) {
    if (Math.random() < 0.2) {
      const nick = pickRandom(bgData.nicknames);
      firstName += ` "${nick}"`;
    }
  }

  // 4. Apply race ability score bonuses
  let finalScores = [...currentScores];
  const ABIL_ORDER = ["STR","DEX","CON","INT","WIS","CHA"];

  for (const [ability, bonus] of Object.entries(raceData.abilityScoreBonuses)) {
    if (ability === "PLUS_TWO_OTHERS") {
      // If not specifically assigned, default to DEX & CON
      const dexIndex = ABIL_ORDER.indexOf("DEX");
      const conIndex = ABIL_ORDER.indexOf("CON");
      finalScores[dexIndex] += 1;
      finalScores[conIndex] += 1;
    } else {
      const index = ABIL_ORDER.indexOf(ability);
      if (index !== -1) {
        finalScores[index] += bonus;
      }
    }
  }

  // 5. Personality Traits: pick exactly 2
  const chosenTraits = pickMultipleDistinct(PERSONALITY_TRAITS, 2);

  // 6. Race & background features
  const featuresList = raceData.features.length
    ? raceData.features.map(feat => `- ${feat}`).join("<br/>")
    : "None";
  const raceLangs = raceData.languages.join(", ");

  // 7. Background eq, skills, etc.
  const bgEquipment = bgData.equipment.map(eq => `- ${eq}`).join("<br/>");
  const bgSkills = bgData.skillProficiencies
    ? bgData.skillProficiencies.join(", ")
    : "None";
  let bgLangs = "None";
  if (bgData.languages && bgData.languages.length > 0) {
    bgLangs = bgData.languages.join(", ");
  }

  // 8. Random weapon & comedic armour
  const chosenWeapon = getRandomWeaponForBackground(bgData.name);
  const proficient = isProficientInWeapon(chosenWeapon, bgData.name);

  // Level-based proficiency
  const levelChoice = document.getElementById("level-select").value;
  let profBonus = 0;
  if (levelChoice === "0.5") {
    profBonus = 1; 
  }
  const weaponStats = computeWeaponStats(chosenWeapon, finalScores, proficient, profBonus);

  const chosenArmour = pickRandom(ARMORS);
  const dexMod = abilityMod(finalScores[1]);
  const computedAC = computeArmourClass(chosenArmour, dexMod);

  // 9. Compile final details
  const fullName = lastName ? firstName + " " + lastName : firstName;

  // Output display
  const outputDiv = document.getElementById("output");
  outputDiv.style.display = "block";
  outputDiv.classList.add("generated");

  // Name as heading
  document.getElementById("charName").innerHTML = fullName;

  document.getElementById("charRace").innerHTML = `<strong>Race:</strong> ${raceData.name}
    <br/><em>Speed:</em> ${raceData.speed} ft
    <br/><em>Features:</em><br/> ${featuresList}`;

  document.getElementById("charBackground").innerHTML = `
    <strong>Background:</strong> ${bgData.name}<br/>
    <em>Skill Proficiencies:</em> ${bgSkills}<br/>
    <em>Equipment:</em><br/>${bgEquipment}<br/>
    <em>Feature:</em> <strong>${bgData.feature}</strong><br/>
    <small>${bgData.featureDesc}</small>
  `;

  document.getElementById("charAbilityScores").innerHTML = formatAbilityScores(finalScores);
  document.getElementById("charProficiencies").innerHTML = `
    <strong>Proficiencies (Level ${levelChoice}, from Race/Background):</strong>
    <br/>Background Skills: ${bgSkills}
  `;
  document.getElementById("charLanguages").innerHTML = `
    <strong>Languages:</strong>
    <br/>From Race: ${raceLangs}
    <br/>From Background: ${bgLangs}
  `;

  let eqHTML = `<strong>Starting Equipment (from Background):</strong><br/>${bgEquipment}`;
  if (weaponStats) {
    const atkSign = (weaponStats.attackBonus >= 0) ? "+" : "";
    const dmgSign = (weaponStats.abilityMod >= 0) ? "+" : "";
    eqHTML += `<br/><br/><strong>Weapon:</strong> ${weaponStats.name}<br/>
      <em>Attack Bonus:</em> ${atkSign}${weaponStats.attackBonus} ${proficient ? "(proficient)" : "(not proficient)"}<br/>
      <em>Damage:</em> ${weaponStats.damageDie} ${dmgSign}${weaponStats.abilityMod} (${weaponStats.damageType})
    `;
  }
  eqHTML += `<br/><br/><strong>Armour:</strong> ${chosenArmour.name} (AC = ${computedAC})`;
  document.getElementById("charEquipment").innerHTML = eqHTML;

  // Personality traits
  const traitsHTML = `
    <h3>Personality Traits</h3>
    <ul>
      <li>${chosenTraits[0]}</li>
      <li>${chosenTraits[1]}</li>
    </ul>
  `;
  document.getElementById("charTraits").innerHTML = traitsHTML;

  // Show Print Button
  document.getElementById("printButton").style.display = "inline-block";
}

/* Format final ability scores to mirror original style */
function formatAbilityScores(scoresArr) {
  const labels = ["STR", "DEX", "CON", "INT", "WIS", "CHA"];
  let output = "<strong>Final Ability Scores (Level 0 or 0.5):</strong><br/>";
  scoresArr.forEach((sc, i) => {
    const mod = abilityMod(sc);
    const modSign = mod >= 0 ? "+" : "";
    output += `${labels[i]}: <strong>${sc}</strong> (${modSign}${mod})<br/>`;
  });
  return output;
}

/* ==================================================
   ========== FULL RANDOM FUNCTION ==================
   ================================================== */
function fullRandom() {
  randomName();
  randomRace();
  randomBackground();
  rollAbilityScores();
  generateCharacter();
}
</script>

</body>
</html>
